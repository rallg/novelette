%% This is file `novelette-fullpage.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-fullpage.sty}%
[2024/02/06 v0.38 LaTeX file (fullpage environment).]
%%

%% This file is loaded AtEndPreamble, when processing interior (not cover).


%%% The fullpage environment.
%   Each fullpage environment begins a new page. After it ends, the following
% material begins a new page. Although a fullpage environment is normally
% used for just one page at a time, it can extend to more than one page.
%   You may nest an upperpage environment at the top of fullpage or contents.
% This is helpful if the lower portion of that page contains on-grid text.
%   Commands \name, \subname, and \format may be used anywhere in fullpage.
% Default page style is empty (no printed header or footer), but you may
% locally over-ride using \thispagestyle.
%   Do not confuse fullpage environment with a full-page floated image.
\newenvironment{fullpage}{% May extend to second page.
  \clearpage%
  \suppressfloats[t]% Ensures that a floated image does not go above opening.
  \suppressfloats[b]% Or beneath.
  \thispagestyle{empty}% May over-ride.
  \null\vspace*{-\@leading}% Helps \vfil, if used.
  \begingroup%
  \setlength\parindent{0pt}%
  \full@pagetrue\allow@icontrue\allow@imagetrue\prevent@floattrue\zm@rktrue%
}{% End the environment:
  \ifvmode\else\par\fi%
  \endgroup% No need to restore line grid.
  \clearpage%
}
%%

%% The legal environment. Useful for copyright page.
\newenvironment{legal}{
%  \iffull@page%
%    \fatal@err{You cannot place the legal environment within fullpage,^^J%
%      because legal creates its own fullpage. Easy fix is to remove the ^^J%
%      fullpage environment that currently surrounds legal.}%
%  \fi%
  \begin{fullpage}%
  \full@pagefalse\allow@imagefalse% Prevents use of \format, etc.
  \vfil%
  \nvt@center%
  \begingroup%
  \setlength\parskip{\@leading}%
  \pretolerance=10000% No hyphenation.
  \catcode`\"=12%
  \add@font@feature{Ligatures=ResetAll,Numbers=ResetAll,RawFeature={-tlig}}%
}{
  \ifvmode\else\par\fi%
  \endgroup%
  \nvt@endcenter%
  \vfil%
  \end{fullpage}%
}
%%

%% Simple dedication. Put it within fullpage:
\newcommand\dedication[1]{%
  \iffull@page%
    \begin{center}%
    \def\baselinestretch{1.14}%
    \itshape\add@font@feature{ScaleAgain=1.14,LetterSpace=2}%
    \spaceskip=1.14\fontdimen2\font %
      plus 1.14\fontdimen3\font minus 1.14\fontdimen4\font#1%
    \end{center}%
  \else%
    \nvt@err{\string\dedication\space may only be used within fullpage}%
      {The \string\dedication\space does not print anything unless you^^J%
       write it within a fullpage environment.}%
  \fi%
}
%%

%% Tools for constructing a table of contents, within fullpage.
% Use \name or \subname or \format for the title of the table.
\newcommand\entry[2]{% {chapter}{page} Not automated! Do it yourself!
  \iffull@page%
    \ifvmode\else\par\fi%
    \strut#1\space. . . #2\strut\par%
  \else%
    \@lert{\string\entry\space may only be used in fullpage. %
      Ignored on page \this@page.}%
  \fi%
}%
\newcommand\linegap[1]{% Adjust inter-line spacing, for nice entries.
  \iffull@page%
    \IfDecimal{#1}{%
      \comp@re{#1<0}{\@okfalse}%
      \comp@re{#1>1}{\@okfalse}%
    }{\@okfalse}%
    \if@ok%
      \edef\baselinestretch{\fpeval{1+#1}}%
    \else%
      \@lert{Bad \string\linegap, in contents. Must be >=0 and <=1. Ignored.}
    \fi%
  \else%
    \@lert{\string\linegap\space may only be used in fullpage. %
      Ignored on page \this@page.}%
  \fi%
}%
%%


%% The \format[options]{text} command may only be used in fullpage.
\def\f@scale{1} \def\f@lf{main} \def\f@align{c} \let\f@font\relax
\DeclareDocumentCommand\format{O{}m}{%
  \iffull@page%
    \begingroup\upshape\@oktrue%
    \ifvmode\else\strut\par\fi%
    \allow@imagefalse\prevent@floattrue%
    \pretolerance=10000% No hyphenation.
    \setlength\parindent{0pt}%
    \StrDel{#1,}{ }[\temp@s]%
    \check@fonts% In novelette-settings.sty.
    \if@ok\xdef\f@lf{\temp@d}\fi%
    \check@align% In novelette-settings.sty.
    \edef\f@align{\temp@d}%
    \check@scale% In novelette-settings.sty.
    \xdef\f@scale{\temp@d}%
    \if@ok%
      \ifin@center\else%
        \ifthenelse{\equal{\f@align}{c}\OR\equal{\f@align}{}}{\nvt@center}{}%
        \ifthenelse{\equal{\f@align}{l}}{\nvt@left}{}%
        \ifthenelse{\equal{\f@align}{r}}{\nvt@right}{}%
        \ifthenelse{\equal{\f@align}{o}}{%
          \ifodd\c@page\nvt@right\else\nvt@left\fi%
        }{}%
        \ifthenelse{\equal{\f@align}{i}}{%
          \ifodd\c@page\nvt@left\else\nvt@right\fi%
        }{}%
      \fi%
      \def\baselinestretch{\f@scale}%
      \edef\temp@d{\fpeval{\f@scale*\@leading}}%
      \rule{0pt}{\temp@d pt}%
      \ifthenelse{\equal{\f@lf}{light}}{\f@light}{}%
      \ifthenelse{\equal{\f@lf}{book}}{\f@book}{}%
      \ifthenelse{\equal{\f@lf}{med}}{\f@med}{}%
      \ifthenelse{\equal{\f@lf}{dark}}{\f@dark}{}%
      \add@font@feature{ScaleAgain=\f@scale,%
        Numbers=ResetAll, LetterSpace=2}#2%
      \edef\temp@d{\fpeval{.3*\f@scale*\@leading}}%
      \rule{0pt}{\temp@d pt}%
      \ifin@center\else%
        \ifthenelse{\equal{\f@align}{c}\OR\equal{\f@align}{}}{\nvt@endcenter}{}%
        \ifthenelse{\equal{\f@align}{l}}{\nvt@endleft}{}%
        \ifthenelse{\equal{\f@align}{r}}{\nvt@endright}{}%
        \ifthenelse{\equal{\f@align}{o}}{%
          \ifodd\c@page\nvt@endright\else\nvt@endleft\fi%
        }{}%
        \ifthenelse{\equal{\f@align}{i}}{%
          \ifodd\c@page\nvt@endleft\else\nvt@endright\fi%
        }{}%
      \fi%
    \else%
      \nvt@err{Bad option for \string\format, page \this@page}%
        {The \string\format\space command uses this syntax:^^J%
         \string\format[align=A,scale=S,font=F]{text}^^J%
         A is one of l c r o i. Alignment. Default c.^^J%
         S is a number between .75 and 6. Scale. Default 1.^^J%
         F is one of main,light,book,med,dark. Default main.}%
    \fi%
    \endgroup%
  \else%
    \nvt@err{\string\format, page \this@page, disallowed there}%
      {\string\format\space commands are only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%


%%
\endinput
%%
%% End of file `novelette-fullpage.sty'.
