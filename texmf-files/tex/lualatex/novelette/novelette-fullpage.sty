%% This is file `novelette-fullpage.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-fullpage.sty}%
[2024/01/01 v0.28 LaTeX file (fullpage environment).]
%%

%% This file is loaded AtEndPreamble, when processing interior (not cover).

% Full Pages:
%   The fullpage environment begins a new page. Although fullpage is intended
% for a single page, it will extend to more than one page if necessary. When it
% ends, the following material will begin on a new page.
%   Do not confuse the fullpage enviroment with a full-page floated image.
% Anything within fullpage is not allowed to float (altough you can place a
% non-floating image).
%   Except with "role", fullpage allows images, icons, \name, \subname, \style,
% and ordinary text, but does not include any main text. You may use
% \thispagestyle{main,plain,empty} to control header/footer.
%   There are three special roles: copyright, dedication, contents. Each role
% pre-formats its contents for that purpose, saving you some coding. You do not
% need to use a role unless you wish.
%   \begin{fullpage} is generic. No particular purpose or format.
%   \begin{fullpage}[role=copyright] pre-formats its contents for a copyright
% page: Centered text, no hyphenation, lining numerals, paragraphs separated
% by empty line, no curly quotes (if used, auto-converted to straight), no use
% of \image, \name, \subname, \style. May use \smalltext and \icon. Empty area
% at top of page, rather than beneath text.
%   \begin{fullpage}[role=dedication] pre-formats its text (brief!) for use
% as a dedication: Slightly larger than normal text, Italics, centered,
% slightly above middle of page.
%   \begin{fullpage}[role=contents,linegap=G,label=L] pre-formats its page as
% a simple table of contents. Option linegap=G uses 0<=G<=1 to spread lines.
% Option label=L changes the page title from CONTENTS to L, where L may be
% whatever you wish (spaces allowed), such as label=Table de Contenu.
% You may not use \name, \subname, \style, \smalltext. May uses \image, \icon.
% Label is automatically inserted at top. Each entry is \entry{which}{page}.
% Page numbers are NOT automatic!
%%

% Environment: fullpage
\def\page@role{} \def\toc@linegap{0} \def\toc@label{CONTENTS}
\newcommand\entry[2]{%
  \ifvmode\else\par\fi\vspace*{\toc@linegap\@leading}%
  \strut#1 \space. . . #2\par\vfil%
}
\newif\iffull@page % True within fullpage environment.
\newenvironment{fullpage}[1][]{%
  \clearpage%
  \StrDel{#1,}{ }[\temp@s]%
  \StrBehind{\temp@s}{role=}[\temp@n]%
  \StrBefore{\temp@n}{,}[\temp@n]%
  \IfSubStr{:copyright:dedication:contents::}{:\temp@n:}{%
    \edef\page@role{\temp@n}%
  }{%
    \nvt@err{Bad fullpage role=\temp@n, page \this@page}%
      {If you set \string\begin{fullpage}[role=R], then R must be one of:^^J%
       copyright dedication contents.}%
  }%
  \suppressfloats[t]% Ensures that a floated image does not go above opening.
  \suppressfloats[b]% Or beneath.
  \null\vspace*{-\@leading}% Helps \vfil, if used.
  \begingroup%
  \def\titl##1{\titling@font##1}%
  \setlength\parindent{0pt}%
  \full@pagetrue\allow@icontrue\prevent@floattrue\zm@rktrue%
  \ifthenelse{\equal{\page@role}{copyright}\OR\equal{\page@role}{dedication}}{%
    \allow@imagefalse}{\allow@imagetrue}%
  \ifthenelse{\equal{\page@role}{copyright}}{%
    \null%
    \def\titl##1{\titling@font##1}%
    \setlength\parskip{\@leading}%
    \hyphenpenalty=10000%
    \exhyphenpenalty=10000%
    \catcode`\"=12%
    \add@font@feature{Ligatures=ResetAll,Numbers=ResetAll,RawFeature={-tlig}}%
    \vfill%
  }{}%
  \ifthenelse{\equal{\page@role}{dedication}}{%
    \null%
    \vfil%
    \def\baselinestretch{1.15}%
    \itshape\add@font@feature{ScaleAgain=1.15,LetterSpace=2}%
    \spaceskip=1.15\fontdimen2\font %%
        plus 1.15\fontdimen3\font minus 1.15\fontdimen4\font%
  }{}%
  \ifthenelse{\equal{\page@role}{contents}}{%
    \add@font@feature{Numbers=ResetAll}%
    \StrBehind{\temp@s}{linegap=}[\temp@n]%
    \StrBefore{\temp@n}{,}[\temp@n]%
    \IfNada{\temp@n}{}{%
      \IfDecimal{\temp@n}{%
        \comp@re{\temp@n<0}{\@okfalse}{\@oktrue}%
        \comp@re{\temp@n>1}{\@okfalse}{}%
        \if@ok%
          \edef\toc@linegap{\temp@n}%
        \else%
          \@lert{Bad value for table of contents linegap. Ignored.}%
        \fi%
      }{%
        \@lert{Bad value for table of contents linegap. Ignored.}%
      }%
    }%
    \StrBehind{#1,}{label=}[\temp@n]%
    \StrBefore{\temp@n}{,}[\temp@n]%
    \IfNada{\temp@n}{}{\edef\toc@label{\temp@n}}%
    \null%
    \vfil%
    \setcounter{temp@count}{\c@page}%
    \style{\toc@label}%
    \null%
    \vfil%
  }{}%
  \ifthenelse{\equal{\page@role}{}}{}{\begin{center}}%
}{% End the environment:
  \ifvmode\else\par\fi%
  \ifthenelse{\equal{\page@role}{}}{}{\end{center}}%
  \vfil%
  \ifthenelse{\equal{\page@role}{dedication}}{\null\null}{}%
  \ifthenelse{\equal{\page@role}{contents}}{%
    \vfil\vfil%
    \comp@re{\c@page>\value{temp@count}}{\thispagestyle{plain}\vfill}{}%
  }{}%
  \endgroup% No need to restore line grid.
}
\AfterEndEnvironment{fullpage}{\clearpage}
%%



%%
\endinput
%%
%% End of file `novelette-fullpage.sty'.
