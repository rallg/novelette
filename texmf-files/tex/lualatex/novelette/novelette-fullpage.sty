%% This is file `novelette-fullpage.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-fullpage.sty}%
[2024/01/16 v0.34 LaTeX file (fullpage environment).]
%%

%% This file is loaded AtEndPreamble, when processing interior (not cover).

% Full Pages:
%   There are four full-page environments: fullpage (generic), copyrightpage,
% dedication, contents. Do not confuse these environments with a full-page
% floated image.
%   Each full-page environment begins a new page. After it ends, the following
% material begins a new page. Although a full-page environment is normally
% used for just one page at t time, it can extend to more than one page.
% But an alert is issued, if copyright or dedication extends to another page.
%   The generic fullpage environment allows nearly anything. The others are
% more restrictive, becuse they are formatted for specific purposes.
%   You may nest an upperpage environment at the top of fullpage or contents.
% This is helpful if the lower portion of that page contains on-grid text.
%   The copyrightpage environment is recommended, but not required if you
% prefer your own format. Advtantage of copyrightpage is pre-styled text,
% so you do not need to write a lot of commands.
%   The dedication (if used) centers its text, slightly above mid-page,
% in Italics, at slightly larger size and spread.
%   The contents (if used) centers its text. Use one of \name, \subname,
% or \formatX (X=a,b,c,d,e,f) to style its page title. Use \linegap
% to expand inter-line spacing. Use \entry{chapter}{page} for each item.
% Use \null for blank lines. Note that Novelette does not provide an automatic
% page title, and does not provide automatic numbering. Do it yourself!
%%

\newif\iffull@page % True within fullpage environment.
\newenvironment{fullpage}{% Generic full page. May extend to second page.
  \clearpage%
  \suppressfloats[t]% Ensures that a floated image does not go above opening.
  \suppressfloats[b]% Or beneath.
  \null\vspace*{-\@leading}% Helps \vfil, if used.
  \begingroup%
  \setlength\parindent{0pt}%
  \full@pagetrue\allow@icontrue\allow@imagetrue\prevent@floattrue\zm@rktrue%
}{% End the environment:
  \ifvmode\else\par\fi%
  \endgroup% No need to restore line grid.
  \clearpage%
}
%%

% Environment: copyrightpage. Recommended format.
\newenvironment{copyrightpage}{%
  \clearpage%
  \suppressfloats[t]% Ensures that a floated image does not go above opening.
  \suppressfloats[b]% Or beneath.
  \thispagestyle{empty}%
  \null\vspace*{-\@leading}% Helps \vfill.
  \vfill%
  \begingroup%
  \setlength\parindent{0pt}%
  \allow@icontrue\allow@imagefalse\prevent@floattrue\zm@rktrue%
  \null%
  \setlength\parskip{\@leading}%
  \hyphenpenalty=10000%
  \exhyphenpenalty=10000%
  \catcode`\"=12%
  \begin{center}%
  \add@font@feature{Ligatures=ResetAll,Numbers=ResetAll,RawFeature={-tlig}}%
}{% End the environment:
  \ifvmode\else\par\fi%
  \end{center}%
  \endgroup%
  \clearpage%
}
%%

% Dedication. If used, immediately follows copyright page.
\newenvironment{dedication}{%
  \clearpage%
  \vfil%
  \thispagestyle{empty}%
  \begin{center}%
  \begingroup%
  \def\baselinestretch{1.14}%
  \itshape\add@font@feature{ScaleAgain=1.14,LetterSpace=2}%
  \spaceskip=1.14\fontdimen2\font %
    plus 1.14\fontdimen3\font minus 1.14\fontdimen4\font%
}{
  \endgroup%
  \end{center}%
  \null\null%
  \vfil%
  \clearpage%
}
%%

% Environment: contents.
\def\linegap#1{0} % Meaningless outside contents.
\def\entry#1#2{\@alert{\string\entry, pg \this@page, ignored. Only contents.}}
\newenvironment{contents}{%
  \clearpage%
  \thispagestyle{empty}%
  \null\vspace*{-\@leading}% Helps \vfil, if used.
  \begingroup%
  \def\entry##1##2{% {chapter}{page}
    \ifvmode\else\par\fi%
    \strut##1\space. . . ##2\strut\par%
  }%
  \@oktrue%
  \def\linegap##1{%
    \IfDecimal{##1}{%
      \comp@re{##1<0}{\@okfalse}%
      \comp@re{##1>1}{\@okfalse}%
    }{\@okfalse}%
    \if@ok%
      \edef\baselinestretch{\fpeval{1+##1}}%
    \else%
      \@lert{Bad \string\linegap, in contents. Must be >=0 and <=1. Ignored.}
    \fi%
  }%
  \setlength\parindent{0pt}%
  \full@pagetrue\allow@imagetrue\allow@icontrue\prevent@floattrue\zm@rktrue%
}{%
  \endgroup%
  \clearpage%
}
%%

% \formata{text}. Global style set by \formatastyle in Preamble.
\newcommand\formata[1]{%
  \iffull@page%
    \ifvmode\else\strut\par\fi%
    \begingroup%
    \allow@imagefalse\prevent@floattrue%
    \hyphenpenalty=20000%
    \setlength\parindent{0pt}%
    \def\baselinestretch{\fa@scale}%
    \fa@b\edef\temp@d{\fpeval{\fa@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}%
    \ifthenelse{\equal{\fa@lf}{light}}{\f@light}{}%
    \ifthenelse{\equal{\fa@lf}{dark}}{\f@dark}{}%
    \ifthenelse{\equal{\fa@lf}{deco}}{\f@deco}{}%
    \ifthenelse{\equal{\fa@lf}{drama}}{\f@drama}{}%
    \add@font@feature{ScaleAgain=\fa@scale,%
      Numbers=ResetAll, LetterSpace=2}#1%
    \edef\temp@d{\fpeval{.3*\fa@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}\fa@e%
    \endgroup%
  \else%
    \nvt@err{\string\formata\space, page \this@page, disallowed there}%
      {\string\formata\space is only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%

% \formatb{text}. Global style set by \formatbstyle in Preamble.
\newcommand\formatb[1]{%
  \iffull@page%
    \ifvmode\else\strut\par\fi%
    \begingroup%
    \allow@imagefalse\prevent@floattrue%
    \hyphenpenalty=20000%
    \setlength\parindent{0pt}%
    \def\baselinestretch{\fa@scale}%
    \fb@b\edef\temp@d{\fpeval{\fb@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}%
    \ifthenelse{\equal{\fb@lf}{light}}{\f@light}{}%
    \ifthenelse{\equal{\fb@lf}{dark}}{\f@dark}{}%
    \ifthenelse{\equal{\fb@lf}{deco}}{\f@deco}{}%
    \ifthenelse{\equal{\fb@lf}{drama}}{\f@drama}{}%
    \add@font@feature{ScaleAgain=\fb@scale,%
      Numbers=ResetAll, LetterSpace=2}#1%
    \edef\temp@d{\fpeval{.3*\fb@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}\fb@e%
    \endgroup%
  \else%
    \nvt@err{\string\formatb\space, page \this@page, disallowed there}%
      {\string\formatb\space is only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%

% \formatc{text}. Global style set by \formatcstyle in Preamble.
\newcommand\formatc[1]{%
  \iffull@page%
    \ifvmode\else\strut\par\fi%
    \begingroup%
    \allow@imagefalse\prevent@floattrue%
    \hyphenpenalty=20000%
    \setlength\parindent{0pt}%
    \def\baselinestretch{\fc@scale}%
    \fc@b\edef\temp@d{\fpeval{\fc@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}%
    \ifthenelse{\equal{\fc@lf}{light}}{\f@light}{}%
    \ifthenelse{\equal{\fc@lf}{dark}}{\f@dark}{}%
    \ifthenelse{\equal{\fc@lf}{deco}}{\f@deco}{}%
    \ifthenelse{\equal{\fc@lf}{drama}}{\f@drama}{}%
    \add@font@feature{ScaleAgain=\fc@scale,%
      Numbers=ResetAll, LetterSpace=2}#1%
    \edef\temp@d{\fpeval{.3*\fc@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}\fc@e%
    \endgroup%
  \else%
    \nvt@err{\string\formatc\space, page \this@page, disallowed there}%
      {\string\formatc\space is only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%

% \formatd{text}. Global style set by \formatdstyle in Preamble.
\newcommand\formatd[1]{%
  \iffull@page%
    \ifvmode\else\strut\par\fi%
    \begingroup%
    \allow@imagefalse\prevent@floattrue%
    \hyphenpenalty=20000%
    \setlength\parindent{0pt}%
    \def\baselinestretch{\fd@scale}%
    \fd@b\edef\temp@d{\fpeval{\fd@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}%
    \ifthenelse{\equal{\fd@lf}{light}}{\f@light}{}%
    \ifthenelse{\equal{\fd@lf}{dark}}{\f@dark}{}%
    \ifthenelse{\equal{\fd@lf}{deco}}{\f@deco}{}%
    \ifthenelse{\equal{\fd@lf}{drama}}{\f@drama}{}%
    \add@font@feature{ScaleAgain=\fd@scale,%
      Numbers=ResetAll, LetterSpace=2}#1%
    \edef\temp@d{\fpeval{.3*\fd@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}\fd@e%
    \endgroup%
  \else%
    \nvt@err{\string\formatd\space, page \this@page, disallowed there}%
      {\string\formatd\space is only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%

% \formate{text}. Global style set by \formatestyle in Preamble.
\newcommand\formate[1]{%
  \iffull@page%
    \ifvmode\else\strut\par\fi%
    \begingroup%
    \allow@imagefalse\prevent@floattrue%
    \hyphenpenalty=20000%
    \setlength\parindent{0pt}%
    \def\baselinestretch{\fe@scale}%
    \fe@b\edef\temp@d{\fpeval{\fe@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}%
    \ifthenelse{\equal{\fe@lf}{light}}{\f@light}{}%
    \ifthenelse{\equal{\fe@lf}{dark}}{\f@dark}{}%
    \ifthenelse{\equal{\fe@lf}{deco}}{\f@deco}{}%
    \ifthenelse{\equal{\fe@lf}{drama}}{\f@drama}{}%
    \add@font@feature{ScaleAgain=\fe@scale,%
      Numbers=ResetAll, LetterSpace=2}#1%
    \edef\temp@d{\fpeval{.3*\fe@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}\fe@e%
    \endgroup%
  \else%
    \nvt@err{\string\formate\space, page \this@page, disallowed there}%
      {\string\formate\space is only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%

% \formatf{text}. Global style set by \formatfstyle in Preamble.
\newcommand\formatf[1]{%
  \iffull@page%
    \ifvmode\else\strut\par\fi%
    \begingroup%
    \allow@imagefalse\prevent@floattrue%
    \hyphenpenalty=20000%
    \setlength\parindent{0pt}%
    \def\baselinestretch{\ff@scale}%
    \ff@b\edef\temp@d{\fpeval{\ff@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}%
    \ifthenelse{\equal{\ff@lf}{light}}{\f@light}{}%
    \ifthenelse{\equal{\ff@lf}{dark}}{\f@dark}{}%
    \ifthenelse{\equal{\ff@lf}{deco}}{\f@deco}{}%
    \ifthenelse{\equal{\ff@lf}{drama}}{\f@drama}{}%
    \add@font@feature{ScaleAgain=\ff@scale,%
      Numbers=ResetAll, LetterSpace=2}#1%
    \edef\temp@d{\fpeval{.3*\ff@scale*\@leading}}%
    \rule{0pt}{\temp@d pt}\ff@e%
    \endgroup%
  \else%
    \nvt@err{\string\formatf\space, page \this@page, disallowed there}%
      {\string\formatf\space is only allowed in fullpage.^^J%
       You used it somewhere else.}%
    \ifvmode\else\strut\par\fi#1\ifvmode\else\strut\par\fi%
  \fi%
}
%%



%%
\endinput
%%
%% End of file `novelette-fullpage.sty'.
