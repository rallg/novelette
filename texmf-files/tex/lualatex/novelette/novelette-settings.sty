%% This is file `novelette-settings.sty',
%% part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-settings.sty}%
[2023/10/01 v0.18b LaTeX file (Preamble settings).]
%%


%% These settings are defined in novelette.cls, for both interior and cover:
%% \booksize is always required. It is the interior page `trim size'.
%% \title and \author are required, except in draft mode (interior only).
%% \intent declares Output Intent. Default SWOP in final mode, otherwise none.


%% SETTINGS THAT ARE ONLY USED FOR BOOK INTERIOR PAGES
%% ----------------------------------------------------------------------------


%% Mode must be set to final, when your writing and editing is done.
\newcommand\mode[1]{
  \ifcover@rt\else
    \StrDel{#1}{ }[\temp@s]
    \fl@gfalse
    \IfSubStr{:draft:shade:final:}{:\temp@s:}{
      \fl@gtrue\xdef\@mode{\temp@s}
    }{}
    \ifthenelse{\equal{\temp@s}{dev}}{ % Developer only.
      \fl@gtrue\gdef\@mode{shade}
      \global\deflength\feeler@wd{4pt}
    }{}
    \iffl@g\else
      \@error{Bad \string\mode{choice}.^^J%
        Choose one: draft shade final.^^J%
        Sets book interior mode. Default draft. Ignored by cover.^^J%
        If any error (such as this one) is generated during compile,^^J%
        then final mode will be automatically switched to draft.}
    \fi
  \fi
}
%%


%% Sheetfeed. (Normally not used.)
% Most print services require that the PDF page size be same as book booksize.
% In a few cases (or for home printing of markup drafts) the book pages
% are floated to the middle of a standard office paper size, letter or A4.
\def\sheet@feed{booksize} % Default.
\DeclareDocumentCommand\sheetfeed{m}{
  \StrDel{#1}{ }[\temp@s]
  \IfSubStr{:booksize:letter:a4:A4:}{:\temp@s:}{
    \ifthenelse{\equal{\temp@s}{a4}}{\def\temp@n{A4}}{\def\temp@n{\temp@s}}
    \xdef\sheet@feed{\temp@n}\fl@gtrue
  }{\fl@gfalse}
  \StrDel{\temp@s}{\sheet@feed}[\temp@s]
  \reject@nonempty{\temp@s}
  \iffl@g\else
    \@error{Bad \string\sheetfeed{choice}.^^J%
      Choose only one: booksize letter A4. Default booksize.^^J%
      If unsure, do not use this setting (accept default).^^J%
      This setting is ignored when processing cover art.}
    \gdef\sheetfeed{booksize}
  \fi
}
%%


%% Margins. (Excludes all printable material. Inside is at spine.)
\def\all@margins{t=13mm,o=13mm,b=13mm,i=16.2mm}
\setlength\m@top{13mm} \setlength\m@out{13mm} % Defaults. 16.2mm>.625in,
\setlength\m@bot{13mm} \setlength\m@ins{16.2mm} % 13mm>.5in, diff>.125in>3mm.
\DeclareDocumentCommand\margins{m}{
  \StrDel{#1,}{ }[\temp@s]
  \StrBehind{\temp@s}{t=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \check@length{\temp@n}
  \iffl@g
    \global\deflength\m@top{\temp@n}
    \ifdimcomp{\m@top}{<}{.25in}{\margin@lerttrue}{}%
    \StrDel{\temp@s}{t=\temp@n,}[\temp@s]
    \StrBehind{\temp@s}{o=}[\temp@n]
    \StrBefore{\temp@n}{,}[\temp@n]
    \check@length{\temp@n}
    \iffl@g
      \global\deflength\m@out{\temp@n}
      \ifdimcomp{\m@out}{<}{.25in}{\margin@lerttrue}{}%
      \StrDel{\temp@s}{o=\temp@n,}[\temp@s]
      \StrBehind{\temp@s}{b=}[\temp@n]
      \StrBefore{\temp@n}{,}[\temp@n]
      \check@length{\temp@n}
      \iffl@g
        \global\deflength\m@bot{\temp@n}
        \ifdimcomp{\m@bot}{<}{.25in}{\margin@lerttrue}{}%
        \StrDel{\temp@s}{b=\temp@n,}[\temp@s]
        \StrBehind{\temp@s}{i=}[\temp@n]
        \StrBefore{\temp@n}{,}[\temp@n]
        \check@length{\temp@n}
        \iffl@g
          \global\deflength\m@ins{\temp@n}
          \ifdimcomp{\m@ins}{<}{.375in}{\margin@lerttrue}{}%
          \StrDel{\temp@s}{i=\temp@n,}[\temp@s]
        \fi
      \fi
    \fi
  \fi
  \iffl@g
    \setlength\temp@l{\m@out+3mm}
    \ifdimcomp{\m@ins}{<}{\temp@l}{\margin@lerttrue}{}%
    \gdef\all@margins{#1}
  \else
    \@error{Bad \string\margins{t=T,o=O,b=B,i=I}^^J%
      t->top, o->outside, b->bottom, i->inside (spine, with glue zone).^^J%
      T,O,B,I have units in|mm. You must set all four of them.^^J%
      Usually I is larger than O by at least 3mm or .125in.}
    \setlength\m@top{13mm} \setlength\m@out{13mm} % Restore defaults.
    \setlength\m@bot{13mm} \setlength\m@ins{16.2mm}
    \gdef\all@margins{t=13mm,o=13mm,b=13mm,i=16.2mm}
  \fi
  \StrDel{\temp@s}{,}[\temp@s]
  \xdef\margin@cruft{\temp@s}
  \ifmargin@lert
    \typeout{ALERT: Unusual margins. Interior bleed is not supported.^^J%
      Nearly all P.O.D. require >=0.25in margins at top, outside, bottom,^^J%
      and minimum 0.375in at inside. For best appearance, inside should^^J%
      exceed outside by at least 3mm or 0.125in. Your settings disagree.^^J%
      Note that many P.O.D. require larger values than these.}
    \g@addto@macro\misc@lert{%
      \typeout{ALERT: Unusual margin settings. Too small? No glue area?}%
    }
  \fi
  \ifthenelse{\equal{\margin@cruft}{}}{}{\g@addto@macro\misc@lert{%
    \typeout{ALERT: Ignored unknown `\margin@cruft' in \string\margins.}}%
  }
}
%%


%% Typesize. (Main font size.)
%% Default typesize is calculated, based on other factors.
\DeclareDocumentCommand\typesize{m}{
  \check@length{#1}
  \iffl@g\global\deflength\type@size{#1}\else
    \@error{Bad \string\typesize{size}.^^J%
      Size has units, pt|bp. Typically 11.0pt-12.0bp.^^J
      Decimal values are permitted (and are often best).^^J
      If unset, Novelette will calculate and use a likely value.}
  \fi
}
%%


%% Lines. (Lines per page, main text block, not including header|footer.)
%% Default lines are calculated, based on other factors.
\DeclareDocumentCommand\lines{m}{ % Integer lines per page, main text only.
  \IfInteger{#1}{
    \xdef\lines@pp{#1}
  }{
    \@error{Bad \string\lines{integer}^^J%
      Lines per page, main text block only (not header|footer).^^J%
      Value must be integer, typically 27-35.^^J
      If unset, Novelette wil calculate and use a likely value.}
  }
}
%%


%% Layout. (scheme, header|footer gaps)
% Format: \layout{scheme=S,hgap=H,fgap=F,scale=N,font=T}
% The five values may be in any order. May omit any, for default.
% S -> Integer 1-7. Selects header/footer scheme from a menu. See docs.
% H -> Number 0-1. May be decimal. Extra line space from header to main text.
% F -> Number 0-1. May be decimal. Extra line space from main text to footer.
% N -> Number .75-1. Scale of page number and header text, relative to main.
% T -> One of main,sans,mono,alt,drama,deco. Default main.
\def\@scheme{2} \def\h@gap{.5} \def\f@gap{.5} \def\hf@scale{1} \def\hf@font{}
\DeclareDocumentCommand\layout{m}{
  \StrDel{#1,}{ }[\temp@s]
  \StrBehind{\temp@s}{hgap=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \fl@gtrue
  \IfDecimal{\temp@n}{
    \begingroup\fl@gtrue
    \@reject{\temp@n<0}
    \@reject{\temp@n>1}
    \iffl@g\xdef\h@gap{\temp@n}\fi
    \endgroup
  }{
    \reject@nonempty{\temp@n}
  }
  \StrDel{\temp@s}{hgap=\h@gap,}[\temp@s]
  \StrBehind{\temp@s}{fgap=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfDecimal{\temp@n}{
    \begingroup\fl@gtrue
    \@reject{\temp@n<0}
    \@reject{\temp@n>1}
    \iffl@g\xdef\f@gap{\temp@n}\fi
    \endgroup
  }{
    \reject@nonempty{\temp@n}
  }
  \StrDel{\temp@s}{fgap=\f@gap,}[\temp@s]
  \StrBehind{\temp@s}{scale=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfDecimal{\temp@n}{
    \begingroup\fl@gtrue
    \@reject{\temp@n<.75}
    \@reject{\temp@n>1}
    \iffl@g\xdef\hf@scale{\temp@n}\fi
    \endgroup
  }{
    \reject@nonempty{\temp@n}
  }
  \StrDel{\temp@s}{scale=\hf@scale,}[\temp@s]
  \StrBehind{\temp@s}{scheme=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfInteger{\temp@n}{
    \begingroup\fl@gtrue
    \@reject{\temp@n<0}
    \@reject{\temp@n>7}
    \iffl@g\xdef\@scheme{\temp@n}\fi
    \endgroup
  }{
    \reject@nonempty{\temp@n}
  }
  \StrDel{\temp@s}{scheme=\@scheme,}[\temp@s]
  \StrBehind{\temp@s}{font=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfSubStr{:main:sans:mono:alt:drama:deco:}{:\temp@n:}{
    \xdef\hf@font{\temp@n}
  }{
    \reject@nonempty{\temp@n}
  }
  \StrDel{\temp@s}{font=\hf@font,}[\temp@s]
  \iffl@g\else
    \@error{Bad \string\layout{scheme=S,hgap=H,fgap=F,scale=N,font=T}.^^J%
      S=integer 1-7. Chooses header/footer scheme. See docs. Default 2.^^J%
      H=number, 0 to 1. May be decimal. Gap header to main. Default .5.^^J%
      F=number, 0 to 1. May be decimal. Gap main to footer. Default .5.^^J%
      N=number, .75 to 1. Scale of page numers and header text. Default 1.^^J%
      T=font, main|sans|mono|alt|drama|deco. Default main}
  \fi
  \StrDel{\temp@s}{,}[\temp@s]
  \xdef\layout@cruft{\temp@s}
  \ifthenelse{\equal{\layout@cruft}{}}{}{\g@addto@macro\misc@lert{%
    \typeout{ALERT: Ignored unknown `\layout@cruft' in \string\layout\space.}}%
  }
}
%%


%% Page number style. Only affects page numbers, not header text.
% Does not switch roman|arabic (that is from frontmatter|mainmatter).
% onum|lnum -> oldstyle or lining numerals. If unset, same as main text.
% ital -> Italics. If unset, Regular.
\def\pn@feat{} \let\pn@ital\relax
\DeclareDocumentCommand\pagenumberstyle{m}{
  \StrDel{#1}{ }[\temp@s]
  \StrDel{\temp@s}{,}[\temp@s]
  \IfSubStr{\temp@s}{onum}{
    \gdef\pn@feat{\addfontfeature{Numbers=ResetAll,Numbers=OldStyle}}
    \StrDel{\temp@s}{onum}[\temp@s]
  }{}
  \IfSubStr{\temp@s}{lnum}{
    \gdef\pn@feat{\addfontfeature{Numbers=ResetAll,Numbers=Lining}}
    \StrDel{\temp@s}{lnum}[\temp@s]
  }{}
  \IfSubStr{\temp@s}{italics}{
    \LetLtxMacro\pn@ital\textit\relax
    \StrDel{\temp@s}{italics}[\temp@s]
  }{}
  \IfSubStr{\temp@s}{italic}{
    \LetLtxMacro\pn@ital\textit\relax
    \StrDel{\temp@s}{italic}[\temp@s]
  }{}
  \IfSubStr{\temp@s}{ital}{
    \LetLtxMacro\pn@ital\textit\relax
    \StrDel{\temp@s}{ital}[\temp@s]
  }{}
  \xdef\pn@cruft{\temp@s}
  \ifthenelse{\equal{\temp@s}{}}{}{\g@addto@macro\misc@lert{%
    \typeout{ALERT: Ignored unknown '\pn@cruft' in \string\pagenumberstyle.}}%
  }
}
%%


%% Guides. (For vertical positioning reference, in shade mode.)
% Up to four guide pairs. This command is parsed in novelette-shading.sty.
% Format: \guides{A,B,C,D} where A,B,C,D are integer lines from top of main.
\DeclareDocumentCommand\guides{m}{\gdef\@guides{#1}}
\guides{} % Default none.
%%


%% Microtype options. (Passes \micro@set as package option to microtype.)
\def\micro@set{config=novelette-microtype,verbose=silent,%
  stretch=20,shrink=20,protrusion=false} % Defaults.
\DeclareDocumentCommand\setmicrotype{m}{
  \StrDel{#1}{ }[\temp@s]
  \ifthenelse{\equal{\temp@s}{default}}{}{
    \StrDel{\temp@s}{ifdraft}[\temp@s]
    \StrDel{\temp@s}{draft}[\temp@s]
    \StrDel{\temp@s}{final}[\temp@s]
    \IfSubStr{\temp@s}{config}{}{
      \g@addto@macro\temp@s{,config=novelette-microtype}
    }
    \IfSubStr{\temp@s}{verbose}{}{
      \g@addto@macro\temp@s{,verbose=silent}
    }
    \xdef\micro@set{\temp@s}
  }
}
%%


%% Various fonts.
% Novelette ships with Swainson and Towhee fonts. Swainson is designed for
% main text, vaguely similar to Garamond (but not a clone). Towhee is designed
% for use in footnotes, as a scale-adjusted Swainson. These are the defaults,
% unless you choose something else using \mainfont.
%   Bold is never used in the main text or headings of popular fiction.
% So instead of shipping bold fonts that would be ignored, the default setup
% duplicates Regular/Italic to Bold/BoldItalic, for Swainson and Towhee.
%   Novelette does not allow \newfontfamily or \newfontface.
% Use \mainfont (=\setmainfont), likewise \sansfont and \monofont.
% You should not need sans or mono, but you may cheat: Any font may be set.
% If you do not set sans or mono, then (surprise!) the main font is used.
%   Settings \altfont, \dramafont, and \decofont are specific to Novelette.
% Each of these is a front-end to another fontspec command, which is not
% available until fontspec loads after Preamble.
%   Although is is possible to use any of these fonts anywhere, you should
% use only the mainfont in main text, possibly with occasional altfont
% when you need a character from another language set. If you use any of
% the other fonts within main text, it will be visually distracting, which is
% very undesirable in the reading-flow of popular fiction.
%   \mainfont{Font Family Name}[features]
%     Example: \mainfont{Adobe Garamond Pro}[Ligatures=Discretionary]
%     If you allow the default Swainson font, or set it manually, then
%     scaled Towhee will automatically be set for footnotes. Otherwise,
%     footnotes will use the scaled mainfont.
%   \sansfont{Font Family Name}[features]
%     Usage: \sans{This is in sansfont.}
%     Chosen font does not need to be sans-serif.
%   \monofont{Font Family Name}[features]
%     Usage: \mono{This is in monofont.}
%     Chosen font does not need to be monospace.
%   \altfont{Font Family Name}[features]
%     Usage: \alt{This is in altfont.}
%     The altfont is useful for occasional characters (such as Greek)
%     that are not in the main font. It is scaled to match main lowercase,
%     so that it mingles better with main text. Good choice: Libertinus Serif.
%     Note: This is identical to defining \fallbackfont, usage \textfallback{}.
%   \dramafont{Font Family Name}[features]
%     Example: \dramafont{Cinzel}
%     Usage: \drama{Dramatic Text}
%     The dramafont is useful for the book title, and other places where
%     you need a distinctive appearance.
%   \decofont{Single Font File Name}[features]
%     Example: \decofont{Roboto-Italic.otf}
%     Usage: \deco{character}
%     The decofont is useful for dingbats. This is a single font file.
%     Choose it by file name, not family name.
%%
\def\main@name{Swainson} \def\main@feat{} \def\sans@feat{}
\def\mono@feat{} \def\alt@feat{} \def\drama@feat{} \def\deco@feat{}
%%
\def\check@features#1{%
  \fl@gtrue%
  \IfSubStr{#1}{Color}{\fl@gfalse}{}%
  \IfSubStr{#1}{Colour}{\fl@gfalse}{}%
  \IfSubStr{#1}{color}{\fl@gfalse}{}%
  \IfSubStr{#1}{colour}{\fl@gfalse}{}%
  \IfSubStr{#1}{Opacity}{\fl@gfalse}{}%
  \IfSubStr{#1}{opacity}{\fl@gfalse}{}%
  \IfSubStr{#1}{Scale}{\fl@gfalse}{}%
  \IfSubStr{#1}{scale}{\fl@gfalse}{}%
  \iffl@g\else%
    \@error{Color, Opacity, and Scale are forbidden as font features.^^J%
       In opening environments: \string\namestyle and \string\subnamestyle.^^J%
       On display pages: \string\style}
  \fi%
}
%%
\DeclareDocumentCommand\mainfont{O{}mO{}}{
  \gdef\main@name{#2}
  \ifthenelse{\equal{#1}{}}{}{\g@addto@macro\main@feat{,#1}}
  \ifthenelse{\equal{#3}{}}{}{\g@addto@macro\main@feat{,#3}}
  \check@features{\main@feat}
}
%%
\DeclareDocumentCommand\sansfont{O{}mO{}}{ % Default is Latin Modern Sans.
  \gdef\sans@name{#2}
  \ifthenelse{\equal{#1}{}}{}{\g@addto@macro\sans@feat{,#1}}
  \ifthenelse{\equal{#3}{}}{}{\g@addto@macro\sans@feat{,#3}}
  \check@features{\sans@feat}
}
%%
\DeclareDocumentCommand\monofont{O{}mO{}}{ % Default is Latin Modern Mono.
  \gdef\mono@name{#2}
  \ifthenelse{\equal{#1}{}}{}{\g@addto@macro\mono@feat{,#1}}
  \ifthenelse{\equal{#3}{}}{}{\g@addto@macro\mono@feat{,#3}}
  \check@features{\mono@feat}
}
%%
\DeclareDocumentCommand\altfont{O{}mO{}}{
  \gdef\alt@name{#2}
  \ifthenelse{\equal{#1}{}}{}{\g@addto@macro\alt@feat{,#1}}
  \ifthenelse{\equal{#3}{}}{}{\g@addto@macro\alt@feat{,#3}}
  \check@features{\alt@feat}
}
\LetLtxMacro\fallbackfont\altfont\relax
%%
\DeclareDocumentCommand\dramafont{O{}mO{}}{
  \gdef\drama@name{#2}
  \ifthenelse{\equal{#1}{}}{}{\g@addto@macro\drama@feat{,#1}}
  \ifthenelse{\equal{#3}{}}{}{\g@addto@macro\drama@feat{,#3}}
  \check@features{\drama@feat}
}
%%
\DeclareDocumentCommand\decofont{O{}mO{}}{
  \gdef\deco@name{#2}
  \ifthenelse{\equal{#1}{}}{}{\g@addto@macro\deco@feat{,#1}}
  \ifthenelse{\equal{#3}{}}{}{\g@addto@macro\deco@feat{,#3}}
  \check@features{\deco@feat}
}
%%


%% Global styles for name and subname in opening environments.
\def\name@align{c} \def\name@font{main} \def\name@scale{1.6}
\def\subname@align{c} \def\subname@font{main} \def\subname@scale{1.25}
\def\n@num{} \def\s@num{}
\DeclareDocumentCommand\namestyle{m}{ % align=A, scale=S, font=F.
  \StrDel{#1,}{ }[\temp@s]
  \fl@gtrue
  \StrBehind{\temp@s}{align=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfSubStr{:l:c:r:o:i:}{:\temp@n:}{
    \xdef\name@align{\temp@n}
  }{
    \ifthenelse{\equal{\temp@n}{}}{\gdef\name@align{c}}{\fl@gfalse}
  }
  \StrDel{\temp@s}{align=\name@align,}[\temp@s]
  \StrBehind{\temp@s}{font=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfSubStr{:main:sans:mono:alt:drama:deco:}{:\temp@n:}{
    \xdef\name@font{\temp@n}
  }{
    \ifthenelse{\equal{\temp@n}{}}{\gdef\name@font{main}}{\fl@gfalse}
  }
  \StrDel{\temp@s}{font=\name@font,}[\temp@s]
  \StrBehind{\temp@s}{scale=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfDecimal{\temp@n}{
    \comp@re{\temp@n<1}{\fl@gfalse}{}
    \comp@re{\temp@n>3}{\fl@gfalse}{}
    \iffl@g\xdef\name@scale{\temp@n}\fi
  }{
    \ifthenelse{\equal{\temp@n}{}}{\gdef\name@scale{1.6}}{\fl@gfalse}
  }
  \StrDel{\temp@s}{scale=\name@scale,}[\temp@s]
  \IfSubStr{\temp@s}{onum,}{\gdef\n@num{o}\StrDel{\temp@s}{onum,}[\temp@s]}{}
  \IfSubStr{\temp@s}{lnum,}{\gdef\n@num{l}\StrDel{\temp@s}{lnum,}[\temp@s]}{}
  \StrDel{\temp@s}{,}[\namescale@cruft]
  \iffl@g\else
    \@error{Bad \string\namestyle{align=A,font=F,scale=S,N}.^^J%
       A may be one of c l r o i. Horizontal alignment. Default c.^^J%
       F is one of main, sans,mono,alt,drama,deco. Font. Default main.^^J%
       S is a number 1-3. May be decimal. Scale. Default 1.6.^^J%
       N is either onum or lnum. Numerals. If unset, same as main text.}
    \def\name@align{c} \def\name@font{main} \def\name@scale{1.6} % Defaults.
  \fi
  \ifthenelse{\equal{\namescale@cruft}{}}{}{\g@addto@macro\misc@lert{%
    \typeout{ALERT: Ignored unknown `\namescale@cruft' in \string\namestyle.}}%
  }
}
%%
\DeclareDocumentCommand\subnamestyle{m}{ % align=A, scale=S, font=F.
  \StrDel{#1,}{ }[\temp@s]
  \fl@gtrue
  \StrBehind{\temp@s}{align=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfSubStr{:l:c:r:o:i:}{:\temp@n:}{
    \xdef\subname@align{\temp@n}
  }{
    \ifthenelse{\equal{\temp@n}{}}{}{\fl@gfalse}
  }
 \StrBehind{\temp@s}{font=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfSubStr{:main:sans:mono:alt:drama:deco:}{:\temp@n:}{
    \xdef\subname@font{\temp@n}
  }{
    \ifthenelse{\equal{\temp@n}{}}{}{\fl@gfalse}
  }
  \StrBehind{\temp@s}{scale=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \IfDecimal{\temp@n}{
    \comp@re{\temp@n<1}{\fl@gfalse}{}
    \comp@re{\temp@n>1.5}{\fl@gfalse}{}
    \iffl@g\xdef\subname@scale{\temp@n}\fi
  }{
    \ifthenelse{\equal{\temp@n}{}}{}{\fl@gfalse}
  }
  \iffl@g\else
    \@error{Bad value in \string\subnamestyle{align=A,font=F,scale=S}.^^J%
       A may be one of c l r o i. Horizontal alignment. Default c.^^J%
       F is one of main,sans,mono,alt,drama,deco. Font. Default main.^^J%
       S is a number 1-3. May be decimal. Scale. Default 1.25.}
    \def\subname@align{c} \def\subname@font{main} \def\subname@scale{1.25}
  \fi
}
%%


%% Language: us or uk english, for now.
\lefthyphenmin=2 \righthyphenmin=3
\def\log@lang{Did not set \string\english. Using older generic patterns.}
\def\eng@lish{american} % Old patterns.
\DeclareDocumentCommand\english{m}{
  \IfFileExists{loadhyph-en-us.tex}{
    \StrDel{#1}{ }[\temp@s]
    \fl@gfalse
    \ifthenelse{\equal{\temp@s}{us}}{
      \fl@gtrue\gdef\eng@lish{usenglishmax}
      \gdef\log@lang{\string\english{us}}
    }{}
    \ifthenelse{\equal{\temp@s}{uk}}{
      \fl@gtrue\gdef\eng@lish{ukenglish}
      \gdef\log@lang{\string\english{uk}}
    }{}
    \iffl@g\else
      \@error{Bad setting for \string\english{choice}. Choose us or uk.}
    \fi
  }{
    \@error{Missing package hyphen-english.}
    \gdef\log@lang{Missing hyphen-english. Used older generic patterns.}
  }
}
\DeclareDocumentCommand\setlang{O{}mO{}}{\english{us}} % Temporary placeholder.
%%


%% Optionally over-ride default 1.5em parindent:
\newcommand\myparindent[1]{\gdef\myown@parindent{#1}}
%%


%% Custom \intent:
\def\custom@cats{ % Because escape characters are different in TeX and XMP.
  \catcode`\#=12
  \catcode`\_=12
  \catcode`\~=12
  \catcode`\$=12
  \catcode`\%=12
  \catcode`\&=12
  \edef\@pctchar{\expandafter\@gobble\string\%}
  \let\%\@pctchar
  \edef\@hashchar{\expandafter\@gobble\string\#}
  \let\#\@hashchar
  \edef\@ampchar{\expandafter\@gobble\string\&amp;}
  \let\&\@ampchar
  \edef\@dollarchar{\expandafter\@gobble\string\$}
  \let\$\@dollarchar
  \edef\@underchar{\expandafter\@gobble\string\_}
  \let\_\@underchar
  \edef\@tildechar{\expandafter\@gobble\string\~}
  \let\~\@tildechar
}
\def\customOIidentifier#1{
  \begingroup\custom@cats\xdef\OIidentifier{#1}\endgroup
}
\def\customOIcondition#1{
  \begingroup\custom@cats\xdef\OIcondition{#1}\endgroup
}
\def\customOIinfo#1{
  \begingroup\custom@cats\xdef\OIinfo{#1}\endgroup
}
\def\customOIregistry#1{
  \begingroup\custom@cats\xdef\OIregistry{#1}\endgroup
}
%%



%% SETTINGS THAT ARE ONLY USED FOR COVER:
%% ----------------------------------------------------------------------------
%% Page size of PDF will be automatically set by measuring cover image size.


%% Image must be raster jpg, pre-processed by cmyk4nvt script.
\DeclareDocumentCommand\coverimage{m}{
  \fl@gtrue
  \IfBeginWith{#1}{/}{\fl@gfalse}{}
  \IfSubStr{#1}{://}{\fl@gfalse}{}
  \IfBeginWith{#1}{..}{\fl@gfalse}{}
  \iffl@g\else
    \fatal@error{Bad location for coverimage file.^^J%
      It may be same directory as main document,^^J%
      or in a subdirectory path, relative to main document.^^J%
      But you may not use an absolute path (beginning with / or ://)^^J%
      and you cannot use ../ to move up directory.}
  \fi
  \IfEndWith{#1}{.jpg}{}{
    \fatal@error{Cover image does not have `.jpg' file extension.}
  }
  \gdef\cover@image{#1}
}
%%


%% Cover Trim is finished cover size, after bleed has been removed.
\DeclareDocumentCommand\covertrim{m}{
  \StrSubstitute{#1,}{ }{}[\temp@s]
  \StrBehind{\temp@s}{w=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \check@length{\temp@n}
  \iffl@g
    \StrBehind{\temp@s}{h=}[\temp@d]
    \StrBefore{\temp@d}{,}[\temp@d]
    \check@length{\temp@d}
  \fi
  \iffl@g
    \gdef\cover@trim{#1}
    \global\deflength\covertrim@w{\temp@n}
    \global\deflength\covertrim@h{\temp@d}
  \else
    \fatal@error{Bad \string\covertrim{w=W,h=H}.^^J%
      W is width of trimmed cover, units in|mm|cm.^^J%
      H is height of trimmed cover, units in|mm|cm.^^J%
      The covertrim is the finished cover size,^^J%
      after surrounding bleed has been trimmed off.^^J%
      The finished size includes rear cover, spine, front cover.^^J%
      The full size of the input cover image is larger,^^J%
      because it must include surrounding bleed areas.}
 \fi
}
%%


%% IGNORE SETTINGS THAT DO NOT PERTAIN:
%% ----------------------------------------------------------------------------


%%
\ifcover@rt % Ignore interior-specific settings.
  \def\@mode{draft} % Default.
  \def\mod@xmplabel{DRAFT } % Default.
  \def\sheetfeed#1{}
  \def\margins#1{}
  \def\typesize#1{}
  \def\lines#1{}
  \def\layout#1{}
  \def\guides#1{}
  \def\setmicrotype#1{}
  \def\namestyle#1{}
  \def\subnamestyle#1{}
  \def\myparindent#1{}
  \DeclareDocumentCommand\mainfont{O{}mO{}}{}
  \DeclareDocumentCommand\sansfont{O{}mO{}}{}
  \DeclareDocumentCommand\monofont{O{}mO{}}{}
  \DeclareDocumentCommand\altfont{O{}mO{}}{}
  \DeclareDocumentCommand\dramafont{O{}mO{}}{}
  \DeclareDocumentCommand\decofont{O{}mO{}}{}
  \DeclareDocumentCommand\english{m}{}
\else % Ignore cover-specific settings.
  \def\@mode{final} % Default.
  \def\mod@xmplabel{COVER } % Default.
  \def\covertrim#1{}
  \def\coverimage#1{}
\fi
%%


%% Issue warning if one or more ALERTs:
\newcommand\warnalert[1]{
  \fl@gfalse
  \ifthenelse{\equal{#1}{on}}{\fl@gtrue\warn@lerttrue}{}
  \ifthenelse{\equal{#1}{off}}{\fl@gtrue}{}
  \iffl@g\else
    \ClassWarningNoLine{novelette}{Bad \string\warnalert{choice}.^^J%
      Choose: on off. Default off.}
  \fi
}
%%


%% ONLY PREAMBLE:
%% ----------------------------------------------------------------------------


%%
\let\margin\margins\relax % In case mis-spelled.
\LetLtxMacro\setmainfont\mainfont\relax
\LetLtxMacro\setsansfont\sansfont\relax
\LetLtxMacro\setmonofont\monofont\relax
\@onlypreamble\booksize
\@onlypreamble\margins
\@onlypreamble\margin
\@onlypreamble\sheetfeed
\@onlypreamble\typesize
\@onlypreamble\lines
\@onlypreamble\layout
\@onlypreamble\mainfont
\@onlypreamble\sansfont
\@onlypreamble\monofont
\@onlypreamble\altfont
\@onlypreamble\dramafont
\@onlypreamble\decofont
\@onlypreamble\english
\@onlypreamble\namestyle
\@onlypreamble\subnamestyle
\@onlypreamble\guides
\@onlypreamble\setmicrotype
\@onlypreamble\myparindent
\@onlypreamble\coverimage
\@onlypreamble\covertrim
\@onlypreamble\warn@lert
%%



%%
\endinput
%%
%% End of file `novelette-settings.sty'.
