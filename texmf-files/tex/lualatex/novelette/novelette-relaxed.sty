%% This is file `novelette-relaxed.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c
%%
\ProvidesFile{novelette-relaxed.sty}%
[2024/03/11 v0.46 LaTeX file (neutralize some standard LaTeX settings).]
%%


%%% This file is loaded early in the document class, before pasring the
%  user settings in Preamble. It resets, undefines, or redefines some
% settings and macros that are used by other document classes.
%   LaTeX uses flexible `glues' and `skips' to arrange things. The standard
% value for many of these settings interferes with the grid layout used by
% Novelette. So they are set to 0pt, or some other appropriate value.
%   Also, many standard macros and environments are not suitable for Novelette.
% Where possible, they are neutralized (simply do nothing). If that cannot
% easily be done, then they are defined to throw an error.
%   Most prominent: No math! The active characters for math mode, and related
% non-text modes, have catcodes changed AtBeginDocument, in the *cls file.
%%

%%% Settings:
\setlength\hoffset{0pt}
\setlength\voffset{0pt}
\setlength\fboxrule{0pt}
\setlength\fboxsep{0pt}
\@twocolumnfalse
\@twosidetrue
\setlength\columnsep{0pt}
\setlength\columnseprule{0pt}
\@mparswitchtrue
\setlength\marginparwidth{0pt}
\setlength\marginparsep{0pt}
\setlength\marginparpush{0pt}
\setlength\abovedisplayskip{0pt}
\setlength\abovedisplayshortskip{0pt}
\setlength\belowdisplayshortskip{0pt}
\setlength\belowdisplayskip{0pt}
\setlength\smallskipamount{0pt}
\setlength\medskipamount{0pt}
\setlength\bigskipamount{0pt}
\setlength\topsep{0pt}
\setlength\partopsep{0pt}
\setlength\parsep{0pt}
\setlength\parskip{0pt}
\setlength\floatsep{0pt}
\setlength\@fpsep{0pt}
\setlength\@fptop{0pt}
\setlength\@fpbot{0pt}
\setlength\textfloatsep{0pt}
\setlength\dbltextfloatsep{0pt}
\setlength\intextsep{0pt}
\setlength\lineskip{0pt}
\setlength\normallineskip{0pt}
\setlength\lineskiplimit{0pt}
\renewcommand\baselinestretch{1}
\widowpenalty 150
\clubpenalty 150
\@lowpenalty   51
\@medpenalty  151
\@highpenalty 301
\vbadness=99999 % Suppress nuisance warnings.
\setcounter{topnumber}{2}
\renewcommand\topfraction{1} % Was .7
\setcounter{bottomnumber}{2} % Was 1
\renewcommand\bottomfraction{1} % Was .3
\setcounter{totalnumber}{5} % was 3
\renewcommand\textfraction{0} % Was .2
\renewcommand\floatpagefraction{1} % Was .5
\setcounter{dbltopnumber}{2}
\renewcommand\dbltopfraction{1} % Was .7
\renewcommand\dblfloatpagefraction{1} % Was .5
\pagestyle{empty} % Until changed.
\pagenumbering{arabic} % Becomes roman at \frontmatter.
\flushbottom
\let\starteven\relax % Only used by subdoc.
%%

%%% Neutralize some macros and environments:
\def\no@cmd#1#2{%
  \nvt@err{Command #1 is not defined in Novelette. Page \thepage}%
    {Novelette is not like other LaTeX document classes.^^J%
     Many standard LaTeX commands are undefined or disabled.^^J%
     Do not use the #1 command. #2}%
}
\def\part{\no@cmd{\noexpand\part}{Maybe try 'deco' environment.}}
\def\chapter{\no@cmd{\noexpand\chapter}{Maybe try 'opening' environment.}}
\def\section{\no@cmd{\noexpand\section}{Maybe try \noexpand\scene.}}
\def\subsection{\no@cmd{\noexpand\subsection}{}}
\def\subsubsection{\no@cmd{\noexpand\subsubsection}{}}
\def\paragraph{\no@cmd{\noexpand\paragraph}{}}
\def\subparagraph{\no@cmd{\noexpand\subparagraph}{}}
\def\appendix{\no@cmd{\noexpand\appendix}{}}
\def\maketitle{\no@cmd{\noexpand\maketitle}{See 'pageiii' environment.}}
\def\makeindex{\no@cmd{\noexpand\makeindex}{}}
\def\theindex{\no@cmd{\noexpand\theindex}{}}
\def\tableofcontents{\no@cmd{\noexpand\tableofcontents}{}}
\def\listoftables{\no@cmd{\noexpand\listoftables}{}}
\def\listoffigures{\no@cmd{\noexpand\listoffigures}{}}
\def\caption{\no@cmd{\noexpand\caption}{}}
\def\index{\no@cmd{\noexpand\index}{}}
%%

%%% Disable some environments:
\def\nodo@env#1{%
  \nvt@err{Environment '#1' does not exist in Novelette, page \thepage.}%
    {Novelette is not like other LaTeX document classes.^^J%
     Many standard LaTeX environments are undefined or disabled.^^J%
     Do not use the '#1' environment.}%
}
\def\abstract{\nodo@env{abstract}} \def\endabstract{}
\def\array{\nodo@env{array}} \def\endarray{}
\def\description{\nodo@env{description}} \def\enddescription{}
\def\displaymath{\nodo@env{displaymath}} \def\enddisplaymath{}
\def\enumerate{\nodo@env{enumerate}} \def\endenumerate{}
\def\eqnarray{\nodo@env{eqnarray}} \def\endeqnarray{}
\def\equation{\nodo@env{equation}} \def\endequation{}
\DeclareDocumentCommand\figure{sO{}}{\nodo@env{figure}} \def\endfigure{}
\def\itemize{\nodo@env{itemize}} \def\enditemize{}
\def\labeling{\nodo@env{labeling}} \def\endlabeling{}
\def\list{\nodo@env{list}} \def\endlist{}
\def\math{\nodo@env{math}} \def\endmath{}
\def\picture{\nodo@env{picture}} \def\endpicture{}
\def\tabbing{\nodo@env{tabbing}} \def\endtabbing{}
\def\tabular{\nodo@env{tabular}} \def\endtabular{}
\def\table{\nodo@env{table}} \def\endtable{}
\def\theorem{\nodo@env{theorem}} \def\endtheorem{}
\def\verbatim{\nodo@env{verbatim}} \def\endverbatim{}
\def\titlepage{%
  \nvt@err{Novelette does not have the 'titlepage' environment}%
    {Use the 'pageiii' environment to design your own title page.}%
}
\def\endtitlepage{}
\def\quotation{%
  \nvt@err{Novelette does not have the 'quotation' environment, page \thepage}%
    {The 'blockindent' environment is a substitute. See Novelette docs.}%
}
\def\endquotation{}
\def\quote{%
  \nvt@err{Novelette does not have the 'quote' environment, page \thepage}%
    {The 'blockindent' environment is a substitute. See Novelette docs.}%
}
\def\endquote{}
\def\verse{%
  \nvt@err{Novelette does not have the 'verse' environment, page \thepage}%
    {The 'blockindent' environment is a substitute. See Novelette docs.}%
}
\def\endverse{}
\def\minipage{%
  \nvt@err{Novelette does not have the 'minipage' environment, page \thepage}%
    {If you are trying to use 'minipage' to start a chapter, then use^^J%
     the 'opening' environment instead. See Novelette docs.}%
}
\def\endminipage{}
%%

%%% Manipulate center environment, to avoid user-center within auto-center:
\let\nvt@center\center\relax
\def\center{\in@centertrue\nvt@center}
\let\nvt@endcenter\endcenter\relax
\def\endcenter{\ifvmode\else\par\fi\nvt@endcenter\in@centerfalse}
%%

%%% Re-define the \input command:
%   Novelette uses \subdoc, not \input or \import, for user-level code.
% Rationale: Prevent user from adding code that will likely break Novelette.
%   \nvt@input may or may not be already defined, depending on subdoc.
\ifdefined\nvt@input\else\let\nvt@input\input\fi
%%

%%% Re-define the \import command:
%   The import package is required by subdoc. This modifed code over-rides
% the import code, so that user cannot directly use \import.
%   Thus, this file must be loaded after packages subdoc and import load.
% Code modified from `import.sty'  Ver 6.2  01-Apr-2020  Donald Arseneau.
% Its license: This software is in the public domain; free of any restrictions.
\newcommand{\nvt@subimport}{\@doimport\nvt@input}
\def\@doimport#1{\@sub@import#1\im@iffileexists}
% #1 = import command,  #2 = switch for *,  #3 = import path extension
\def\@sub@import#1#2#3{%
  \begingroup
  \protected@edef\@tempa{\endgroup
    \let\noexpand\IfFileExists\noexpand#2%
    \noexpand\@import  \noexpand#1%  param 1
      {\@ifundefined{input@path}{}{\input@path}}% 2
      {\@ifundefined{Ginput@path}{}{\Ginput@path}}% 3
      {\import@path#3}{\import@path}% 4,5
      {\ifx\IfFileExists\im@@IfFileExists \noexpand\im@@IfFileExists 
       \else \noexpand\IfFileExists \fi}}% 6
  \@tempa}
%
% #1 = import command (\input or \include)
% #2 = previous input path list. #3 = previous graphics input path list.
% #4 = full path added to each.  #5 = previous import path.  
% #6 = previous \IfFileExists.   #7 = file name.
%
\def\@import#1#2#3#4#5#6#7{%
  \protected@xdef\import@path{\import@path@fix{#4}}%
  \protected@edef\input@path{{\import@path}#2}%
  \protected@edef\import@path@file{% use full path/file for non-*
    \import@path #7}%
  \expandafter#1\expandafter{\import@path@file}%
  \let\IfFileExists#6% restore after \import*
  \gdef\import@path{#5}%
  \def\input@path{#2}\ifx\input@path\@empty \let\input@path\@undefined \fi
}
% Our version of \IfFileExists that gives priority to files on \input@path,
% #1 = file name,  #2 = action when exists, #3 = action when not exists
\DeclareRobustCommand\im@iffileexists[1]{%
  \set@curr@file{#1}%
  \expandafter\im@iffileexists@\expandafter{\@curr@file}}
\long\def \im@iffileexists@#1#2#3{%
  \let\@filef@und\@undefined
  \ifx\input@path\@undefined\else 
    \@iffileonpath{#1}{% (also defines \@filef@und)
      \def\reserved@a{#2}%
    }{}% no action yet for not found
  \fi
  \ifx\@filef@und\@undefined % not found on \input@path
    \openin\@inputcheck"#1" %
    \ifeof\@inputcheck
      \def\reserved@a{#3}%
    \else
      \closein\@inputcheck
      \edef\@filef@und{"#1" }%
      \def\reserved@a{#2}%
  \fi\fi
  \reserved@a
}
\let\im@@IfFileExists\IfFileExists % remember original
\gdef\import@path{}
\let\import@path@fix\@firstofone % default
% Check for "./" currdir, and make \import@path@fix ensure trailing /
\gdef\@gtempa{./}
\ifx\@gtempa\@currdir % *x style paths
\gdef\import@path@fix#1{\ifx\delimiter#1\delimiter\else
  \@ensure@one@trailing@slash#1///\delimiter\fi}%
 \gdef\@ensure@one@trailing@slash#1///#2\delimiter{#1/}%
\fi
% Check for "[]" currdir (VMS file names) and set \import@path@fix appropriately
% \subimport{[.subdir]}{file}
\gdef\@gtempa{[]}
\ifx\@gtempa\@currdir % VMS directory syntax
 \gdef\import@path@fix#1{\@gobbleVMSbrack#1][>}
 \gdef\@gobbleVMSbrack#1][#2{#1\ifx>#2\@empty
    \expandafter \strip@prefix \fi % Gobble up to >
    \@gobbleVMSbrack #2}
\fi
%%


%%
\endinput
%%
%% End of file `novelette-relaxed.sty'.
