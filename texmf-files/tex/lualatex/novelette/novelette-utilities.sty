%% This is file `novelette-utilities.sty', part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-utilities.sty}%
[2023/10/01 v0.18b LaTeX file (user macros in document body).]
%%


%% This file is loaded when processing interior (not cover).

\def\br{\\} % Alternative break.

\def\fillertext{%
  \ifthenelse{\equal{\@mode}{final}}{\unskip}{\input{novelette-filler.tex}}
}

%%
\def\frontmatter{%
  \ifmain@matter%                                                                                                                                                                                  \@error{Cannot use \string\frontmatter\space after \string\mainmatter.}%
  \else%
    \pagenumbering{roman}%
    \pagestyle{empty}%
    \global\front@mattertrue%
  \fi%
}
\def\mainmatter{ % Resets page to 1, arabic numbers.
  \ifmain@matter\else%
    \cleartorecto%
    \pagenumbering{arabic}%
    \setcounter{page}{1}%
    \pagestyle{fancy}%
    \gdef\verso@head{\allsmcp{\thetitle}}%
    \gdef\recto@head{\textit{\theauthor}}%
  \fi%
  \global\front@matterfalse%
  \global\main@mattertrue%
}
\def\backmatter{% Usually not used.
  \cleartorecto%
  \gdef\verso@head{}%
  \gdef\recto@head{}%
}
%%


%% \stake does not occupy much vertical space.
\gdef\stake{\rule{0pt}{.02pt}}
%%


%% Steal a sheep.
\def\baa{\looseness=-1}
%%


%% Catalan punt volat:
\def\L#1#2{\ifthenelse{\equal{#1}{.}\AND\equal{#2}{L}}{L·L}{#1#2}}
\def\l#1#2{\ifthenelse{\equal{#1}{.}\AND\equal{#2}{l}}{l·l}{#1#2}}
%%


%% Add or remove an OpenType feature by its code:
\DeclareDocumentCommand\feat{mm}{%
  \ifthenelse{\equal{#1}{}}{%
    {#2\obeyspaces}%
  }{%
    {\addfontfeature{RawFeature={#1}}#2}\obeyspaces%
  }%
}
%%


%% ITALICS (better than \textit or \itshape)
\long\def\ital#1{{\itshape #1\/}}
\long\def\textit#1{{\itshape #1\/}}
%%


%% BLOCK INDENT (option is integer number of \normalindent, [L,R])
\def\t@bindent{0}
\newenvironment{blockindent}[1][1]{%
  \ifvmode\else\par\fi%
  \begingroup%
  \StrDel{#1}{ }[\temp@s]%
  \StrDel{\temp@s}{:}[\temp@s]%
  \StrSubstitute{\temp@s}{,}{:}[\temp@s]%
  \fl@gtrue%
  \edef\temp@d{\fpeval{\textwidth / \normalindent}}%
  \IfInteger{\temp@s}{
    \comp@re{\temp@s<\temp@d}{%
      \setlength\leftskip{\temp@s\normalindent}%
      \xdef\t@bindent{\temp@s}%
    }{\fl@gfalse}%
  }{%
    \StrBefore{\temp@s}{:}[\temp@n]%
    \IfInteger{\temp@n}{%
      \comp@re{\temp@n<\temp@d}{%
        \setlength\leftskip{\temp@n\normalindent}%
        \xdef\t@bindent{\temp@n}%
      }{\fl@gfalse}%
    }{\fl@gfalse}%
    \StrBehind{\temp@s}{:}[\temp@n]%
    \IfInteger{\temp@n}{%
      \comp@re{\temp@n<\temp@d}{%
        \setlength\rightskip{\temp@n\normalindent}%
      }{\fl@gfalse}%
    }{\fl@gfalse}%
  }%
  \setlength\temp@l{\leftskip+\rightskip+4\normalindent}%
  \ifdimcomp{\temp@l}{>}{\textwidth}{\fl@gfalse}{}%
  \iffl@g\else%
    \@error{Bad option for \string\begin{blockindent}[option].^^J%
      Format: \string\begin{blockindent}[L,R]^^J%
      L is integer >=0. Left indent, multiple of normal paragraph indent.^^J%
      R is integer >=0. Right indent, multiple of normal paragraph indent.^^J%
      May use L alone, for only left indent.^^J%
      Remaining block width must be at least 4 normal indents.}%
  \fi%
}{%
  \ifvmode\else\par\fi%
  \endgroup%
  \gdef\t@bindent{0}%
}
%%


%% TABLINE
\DeclareDocumentCommand\tabline{sO{}mm}{%
  \noindent%
  \begingroup%
  \setlength\leftskip{0pt}%
  \noindent\strut%
  \ifthenelse{\equal{\t@bindent}{0}}{}{%
    \makebox[\t@bindent\normalindent][r]{#2\,}%
  }%
  {#3}%
  \IfBooleanTF{#1}{%
    \space\leaders\hbox{.\,}\hfill%
  }{%
    \hfill%
  }%
  {#4}\strut\par%
  \endgroup%
}
%%


%% \init[kern]{Letter}{phrase} for optional styling first line of a chapter.
\DeclareDocumentCommand\init{O{0}mm}{%
  \noindent\smash{\addfontfeature{ScaleAgain=1.33}#2}%
  \IfDecimal{#1}{\kern#1em}{%
    \ClassWarning{novelette}{Bad kern value in \string\init, page \thepage.^^J%
      This kern does not use units, just the number (units will be em).}%
  }%
  \smcp{#3}%
}
%%


%% \cleartorecto works same as \clearpage when next page is recto.
%   If next page would be verso, a blank verso is inserted,
%   so that the following material is recto.
\newcommand\cleartorecto{
  \clearpage
  \ifodd\c@page\else
    \thispagestyle{empty}\null\clearpage
  \fi
}
%%


%% BLANK PAGE
\def\blankpage{%
  \clearpage%
  \thispagestyle{empty}%
  \null%
  \clearpage%
}
%%



%%
\endinput
%%
%% End of file `novelette-utilities.sty'.
