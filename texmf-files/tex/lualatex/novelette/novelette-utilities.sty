%% This is file `novelette-utilities.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-utilities.sty}%
[2024/01/23 v0.37 LaTeX file (user macros in document body).]
%%

%% This file is loaded AtBeginDocument when processing interior (not cover).


%% Filler text, for testing page layout in shade mode:
\def\non@one{Yes no top a the be, win if how do see by can, or the go sat up}
\def\non@two{My won a be cat no sip egg to dog hop}
\def\non@three{See on too a the why at ago per if met bog}
\def\non@four{If lap net a go be tin, tee why cap a he me not hex do sit}
\def\non@five{Go bun at shy a dip on}
\def\par@one{\non@one. \non@two. \non@three. \non@four. \non@five.\par}
\def\par@two{\non@two. \non@four. \non@three. \non@two.\par}
\def\par@three{\non@four. \non@five. \non@two. \non@one. \non@three.\par}
\def\ut@n{\non@one. \non@two. \non@three. \non@one. \non@four. \non@three.\par}
\def\all@non{\ut@n \ut@n \ut@n \ut@n \ut@n \ut@n \ut@n \ut@n \ut@n \ut@n \ut@n}
\def\filler@text{%
    \header{Verso Filler}{Recto Filler}
    \begin{upperpage}\null\null\null\name{Filler Text}
    \null\subname{A Bunch of Nonsense}\null\null\null\end{upperpage}
    \init{D}[oo doo just for you.] \par@one
    \scene{I. Bibble Babble} \all@non\all@non\cleartorecto
}
%%



\def\br{\\} % Alternative break.
\def\TeX{TeX}
\def\LaTeX{LaTeX}

\xdef\this@page{\thepage} %%%%%

\def\formatX#1{#1%
  \nvt@error{There is no command \space\formatX, page \this@page}%
  {Instead of \string\formatX, use \string\formata ... \string\formatf.}
}
\let\formatx\formatX
%%

%% Hawai'an okina:
\ifdefined\okina\else\def\okina{\uni{02BB}}\fi
%%

%% For developer visualization only:
\ifthenelse{\equal{\@mode}{dev}}{
  \def\up@feeler#1{{\gr@y{.5}\rule{4pt}{#1}}\kern-4pt}
  \def\dn@feeler#1{{\gr@y{.7}\rule[-#1]{4pt}{#1}}\kern-4pt}
}{
  \def\up@feeler#1{\rule{0pt}{#1}}
  \def\dn@feeler#1{\rule[-#1]{0pt}{#1}}
}
%%

%% Unicode character, BMP. Four hex digits, uppercase A-F, no following space.
% Examples: c\uni{0061}t -> cat  d\uni{006F}g -> dog
\def\uni#1{\strut{\add@font@feature{Ligatures=ResetAll}\char"#1}\obeyspaces}
%%

%% Front matter, main matter:
\newif\iffront@matter \newif\ifmain@matter
\def\frontmatter{%
  \ifmain@matter%
    \nvt@err{Cannot use \string\frontmatter\space after \string\mainmatter}%
      {You wrote the commands in wrong order.^^J%
       Or did you use \string\mainmatter\space twice?}%
  \else%
    \ifdefined\my@roman%
      \pagenumbering{Roman}% Uppercase.
    \else%
      \pagenumbering{roman}% Lowercase.
    \fi%
    % For uppercase, write \pagenumbering{Roman} after \frontmatter.
    \pagestyle{empty}%
    \global\front@mattertrue%
    \setcounter{bookmatter}{1}%
  \fi%
}
\def\mainmatter{ % Resets page to 1, arabic numbers.
  \ifmain@matter\else%
    \cleartorecto%
    \pagenumbering{arabic}%
    \setcounter{page}{1}%
    \pagestyle{normal}%
    \gdef\verso@head{\allsmcp{\thetitle}}%
    \gdef\recto@head{\textit{\theauthor}}%
  \fi%
  \global\front@matterfalse%
  \global\main@mattertrue%
  \setcounter{bookmatter}{2}%
}
% Usally \backmatter is not used. Does not reset page count or numeral style.
\def\backmatter{%
  \cleartorecto%
  \gdef\verso@head{}%
  \gdef\recto@head{}%
}
%%

%% Catalan punt volat:
\def\L#1#2{\ifthenelse{\equal{#1}{.}\AND\equal{#2}{L}}{L·L}{L#1#2}}
\def\l#1#2{\ifthenelse{\equal{#1}{.}\AND\equal{#2}{l}}{l·l}{l#1#2}}
%%


%% Italics (better than \textit or \itshape):
\long\def\ital#1{{\itshape #1\/}}
\long\def\textit#1{{\itshape #1\/}}
%%

%% Block Indent (option is number of \p@rindent, [L,R]):
\newenvironment{blockindent}[1][1]{%
  \ifvmode\else\par\fi%
  \begingroup%
  \StrDel{#1}{ }[\temp@s]%
  \@oktrue%
  \StrBefore{\temp@s}{,}[\temp@n]%
  \IfNada{\temp@n}{%
    \setlength\leftskip{\p@rindent}%
  }{%
    \IfDecimal{\temp@n}{%
      \setlength\leftskip{\temp@n\p@rindent}%
    }{\@okfalse\setlength\leftskip{\p@rindent}}%
  }%
  \StrBehind{\temp@s}{,}[\temp@n]%
  \IfNada{\temp@n}{%
    \setlength\rightskip{0pt}%
  }{%
    \IfDecimal{\temp@n}{%
      \setlength\rightskip{\temp@n\p@rindent}%
    }{\@okfalse\setlength\rightskip{0pt}}%
  }%
  \setlength\temp@l{\textwidth-\leftskip-\rightskip}%
  \comp@re{\temp@l<.4*\textwidth}{\@okfalse}{}%
  \if@ok\else%
    \nvt@err{Bad option for \string\begin{blockindent}[option]}%
      {Format: \string\begin{blockindent}[L,R]^^J%
       L is number >=0. Left indent, multiple of normal paragraph indent.^^J%
       R is number >=0. Right indent, multiple of normal paragraph indent.^^J%
       May use L alone, for only left indent.^^J%
       Remaining block width must be at least 0.4 textwidth.}%
  \fi%
}{%
  \ifvmode\else\par\fi%
  \endgroup%
}
%%

%% \cleartorecto works same as \clearpage when next page is recto.
%   If next page would be verso, a blank verso is inserted,
%   so that the following material is recto.
\newcommand\cleartorecto{
  \clearpage
  \ifodd\c@page\else
    \thispagestyle{empty}\null\clearpage
  \fi
}
%%

%% Blank Page:
% Note that two consecutive \clearpage does not insert a blank page.
\def\blankpage{%
  \clearpage%
  \thispagestyle{empty}%
  \null%
  \clearpage%
}
%%

%% The following \def fails if directly written into \AtBeginDocument.
% OK if loaded using \RequirePackage. Mystery TeX.
\newcounter{dbl@qq} % Counts use of straight double quotes in document body.
\catcode`\"=13
\def"{”\stepcounter{dbl@qq}}
%%


%%
\endinput
%%
%% End of file `novelette-utilities.sty'.
