%% This is file `novelette-utilities.sty', part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-utilities.sty}%
[2023/09/13 v0.13 LaTeX file (user macros in document body).]
%%


%% This file is not loaded when processing cover.


%%
\def\nvt@rectohead{}
\def\nvt@versohead{}
\def\frontmatter{%
  \ifmain@matter%
    \@error{Cannot use \string\frontmatter\space after \string\mainmatter.}
  \fi%
  \iffront@matter\else%
    \pagenumbering{roman}%
    \setcounter{page}{1}%
    \pagestyle{empty}%
  \fi%
  \global\front@mattertrue%
  \global\main@matterfalse%
}
\def\mainmatter{ % Resets page to 1, arabic numbers; freeze frontpagecount.
  \ifmain@matter\else%
    \cleartorecto%
    \pagenumbering{arabic}%
    \setcounter{page}{1}%
    \pagestyle{fancy}%
    \gdef\nvt@versohead{\allsmcp{\thetitle}}%
    \gdef\nvt@rectohead{\textit{\theauthor}}%
  \fi%
  \global\front@matterfalse%
  \global\main@mattertrue%
}
\def\backmatter{% Usually not used.
  \cleartorecto%
  \gdef\nvt@versohead{}%
  \gdef\nvt@rectohead{}%
}
%%


%% \memo{} does not print or save its argument. May be more than one paragraph.
% Useful when you wish to put a note to yourself in the *.tex document.
% Not the same as % comment, because anything after \memo{} prints.
\long\def\memo#1{\ignorespaces}
%%


%% \stake does not occupy much vertical space.
\gdef\stake{\rule{0pt}{.02pt}}
%%


%% Steal a sheep.
\def\baa{\looseness=-1}
%%


%% Unicode character. Four hex digits, uppercase A-F, no following space.
%% Examples: c\uni{0061}t -> cat  d\uni{006F}g -> dog
\def\uni#1{{\addfontfeature{Ligatures=ResetAll}\char"#1}\obeyspaces}
%%


%% Catalan punt volat:
\def\L#1#2{\ifthenelse{\equal{#1}{.}\AND\equal{#2}{L}}{L·L}{#1#2}}
\def\l#1#2{\ifthenelse{\equal{#1}{.}\AND\equal{#2}{l}}{l·l}{#1#2}}
%%


%% Add or remove an OpenType feature by its code:
\DeclareDocumentCommand\feat{mm}{%
  \StrDel{#1}{-}[\temp@n]%
  \IfBeginWith{#1}{-}{%
    {\addfontfeature{RawFeature=-\temp@n}#2}%
  }{%
    \ifthenelse{\equal{\temp@n}{same}}{}{% Code same is a placeholder.
      {\addfontfeature{RawFeature=\temp@n}#2}%
    }%
  }%
  \obeyspaces%
}
%%


%% ITALICS (better than \textit or \itshape)
\long\def\ital#1{{\itshape #1\/}}
\long\def\textit#1{{\itshape #1\/}}
%%


%% BLOCK INDENT (option is integer number of \normalindent, [L,R])
\def\nvt@tabindent{0}
\newenvironment{blockindent}[1][1]{%
  \ifvmode\else\par\fi%
  \begingroup%
  \StrDel{#1}{ }[\temp@s]%
  \StrDel{\temp@s}{:}[\temp@s]%
  \StrSubstitute{\temp@s}{,}{:}[\temp@s]%
  \@oktrue%
  \FPdiv{\temp@d}{\strip@pt\textwidth}{\strip@pt\normalindent}%
  \IfInteger{\temp@s}{
    \FPiflt{\temp@s}{\temp@d}%
      \setlength\leftskip{\temp@s\normalindent}%
      \xdef\nvt@tabindent{\temp@s}%
    \else\@okfalse\fi%
  }{%
    \StrBefore{\temp@s}{:}[\temp@n]%
    \IfInteger{\temp@n}{%
      \FPiflt{\temp@n}{\temp@d}%
        \setlength\leftskip{\temp@n\normalindent}%
        \xdef\nvt@tabindent{\temp@n}%
      \else\@okfalse\fi%
    }{\@okfalse}%
    \StrBehind{\temp@s}{:}[\temp@n]%
    \IfInteger{\temp@n}{%
      \FPiflt{\temp@n}{\temp@d}%
        \setlength\rightskip{\temp@n\normalindent}%
      \else\@okfalse\fi%
    }{\@okfalse}%
  }%
  \setlength\temp@l{\leftskip+\rightskip+4\normalindent}%
  \ifdimcomp{\temp@l}{>}{\textwidth}{\@okfalse}{}%
  \if@ok\else%
    \@error{Bad option for \string\begin{blockindent}[option].^^J%
      Format: \string\begin{blockindent}[L,R]^^J%
      L is integer >=0. Left indent, multiple of normal paragraph indent.^^J%
      R is integer >=0. Right indent, multiple of normal paragraph indent.^^J%
      May use L alone, for only left indent.^^J%
      Remaining block width must be at least 4 normal indents.}%
  \fi%
}{%
  \ifvmode\else\par\fi%
  \endgroup%
  \gdef\nvt@tabindent{0}%
}
%%


%% TABLINE
\DeclareDocumentCommand\tabline{sO{}mm}{%
  \noindent%
  \begingroup%
  \setlength\leftskip{0pt}%
  \noindent\strut%
  \ifthenelse{\equal{\nvt@tabindent}{0}}{}{%
    \makebox[\nvt@tabindent\normalindent][r]{#2\,}%
  }%
  {#3}%
  \IfBooleanTF{#1}{%
    \space\leaders\hbox{.\,}\hfill%
  }{%
    \hfill%
  }%
  {#4}\strut\par%
  \endgroup%
}
%%


%% \init[kern]{Letter}{phrase} for optional styling first line of a chapter.
\DeclareDocumentCommand\init{O{0}mm}{%
  \noindent\smash{\addfontfeature{ScaleAgain=1.33}#2}%
  \IfDecimal{#1}{\kern#1em}{%
    \ClassWarning{novelette}{Bad kern value in \string\init, page \thepage.^^J%
      This kern does not use units, just the number (units will be em).}%
  }%
  \smcp{#3}%
}
%%


%% \cleartorecto works same as \clearpage when next page is recto.
%   If next page would be verso, a blank verso is inserted,
%   so that the following material is recto.
\newcommand\cleartorecto{
  \clearpage
  \ifodd\c@page\else
    \thispagestyle{empty}\null\clearpage
  \fi
}
%%


%% BLANK PAGE
\def\blankpage{%
  \clearpage%
  \thispagestyle{empty}%
  \null%
  \clearpage%
}
%%



%%
\endinput
%%
%% End of file `novelette-utilities.sty'.
