%% This is file `novelette-footnotes.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-remarks.sty}%
[2024/01/11 v0.31 LaTeX file (commands for footnotes).]
%%

%% This file is loaded AtEndPreamble, when processing interior (not cover).

%% FOOTNOTES
% The use of footnotes is restricted to the kind that is occasioanlly used in
% popular fiction. If you need more features, then Novelette is not for you.
%   The \footnote command has no options. Other footnote-related commands
% are disabled.
%   If a \footnote is placed within an opening environmant, or a display page,
% it does not print a reference marker there. T the unmarked footnote appears
% at page bottom. This is standard style for general notes that are not
% specific to a sentence.
%   Otherwise, \footnote prints a symbolic reference marker, and marks the
% footnote at page bottom. The symbol will be * † ‡ § ** †† ‡‡ §§ for the
% first 8 marked footnotes. The cycle repeats, if more than 8. When an
% opening is used, the count re-sets. Swainson font has characters designed
% for this purpose. The first line of a footnote is indented.
%   If the footnote is placed very low on a page, its text may not fit there,
% so it will move to the next page. A lengthy footnote (discouraged) will not
% split to more than one page.
%%


%% FOOTNOTE (differs from standard LaTeX footnote).
\setlength\footnotesep{.83\@leading}
\newif\ifzm@rk % True for unmarked footnotes in openings.
% The rule is 0.4pt high. That, plus the two kerns, must total 0pt.
\def\footnoterule{% You may change the width.
  \kern -3\p@ \hrule \@width .2\textwidth \kern 2.6\p@ %
}%
\LetLtxMacro\f@@tn@te\footnote\relax
\DeclareDocumentCommand\footnote{O{}+m}{% Option ignored.
  \iffull@page\@okfalse\else\@oktrue\fi%
  \if@ok\f@@tn@te{#2}\else%
    \nvt@err{Cannot use footnote in fullpage environment, page \this@page}%
      {Novelette disallows the \string\footnote\space command^^J%
       on a fullpage. It would disturb the page layout. If you need^^J%
       something at page bottom, try \string\vfill\space above it.}%
  \fi%
}
\DeclareDocumentCommand\no@fncmd{O{}+m}{%
  \nvt@err{Used prohibited footnote-related command, page \this@page}%
    {Cannot use \string\footnotemark, \string\footnotetext.^^J%
     Their contents are ignored. Use only \string\footnote, without option.}%
}
\LetLtxMacro\footnotemark\no@fncmd\relax
\LetLtxMacro\footnotetext\no@fncmd\relax
%%


%% REFERENCE MARKS
% \@makefnmark is an existing LaTeX macro, redefined here. Marker in main text.
% Swainson has superscript symbolic markers, designed for this purpose.
\newcounter{fnm@num} \setcounter{fnm@num}{1}
\def\@makefnmark{\ifzm@rk\else\get@fnmark\fi}
\def\get@fnmark{% Places marker in the main text.
  \case@test{\arabic{fnm@num}}%
  \c@se{1}{\gdef\fn@mark{*}}%
  \c@se{2}{\gdef\fn@mark{†}}%
  \c@se{3}{\gdef\fn@mark{‡}}%
  \c@se{4}{\gdef\fn@mark{§}}%
  \c@se{5}{\gdef\fn@mark{**}}%
  \c@se{6}{\gdef\fn@mark{††}}%
  \c@se{7}{\gdef\fn@mark{‡‡}}%
  \c@se{8}{\gdef\fn@mark{§§}}%
  \sups{\fn@mark}%
}
\def\bfn@mark{% Bottom footnote marker.
  \fn@mark%
  \ifthenelse{\equal{\value{fnm@num}}{8}}%
    {\setcounter{fnm@num}{1}}%
    {\stepcounter{fnm@num}}%
}
%%


%% FOOTNOTE TEXT
% The actual footnote, at bottom of textblock, text in \@footnotesize.
\interfootnotelinepenalty=\@M % Prevent break across pages.
\long\def\@footnotetext#1{%
  \begingroup%
  \spaceskip=.83\fontdimen2\font %
      plus .83\fontdimen3\font minus .83\fontdimen4\font%
  \def\baselinestretch{.83}%
  \add@font@feature{ScaleAgain=.83}%
  \insert\footins{%
    \interlinepenalty\interfootnotelinepenalty%
    \floatingpenalty\@MM%
    \hsize\columnwidth%
    \@parboxrestore%
    \def\@currentcounter{footnote}%
    \setlength\parindent{\p@rindent}%
    \vspace{0pt}%
    \noindent%
    \ifzm@rk%
      \makebox[\parindent][l]{}\rule{0pt}{.83\strut@ht}#1%
    \else%
      \makebox[\parindent][r]{\bfn@mark\space}\rule{0pt}{.83\strut@ht}#1%
    \fi%
    \rule[-.83\strut@dp]{0pt}{.83\strut@dp}%
  }%
  \endgroup%
}
%%



%%
\endinput
%%
%% End of file `novelette-footnotes.sty'.
