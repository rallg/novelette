%% This is file `novelette-footnotes.sty', part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-remarks.sty}%
[2023/12/11 v0.24 LaTeX file (commands for footnotes).]
%%


%% This file is loaded AtEndPreamble, when processing interior (not cover).


%% FOOTNOTES
% The use of footnotes is restricted to the kind that is occasioanlly used in
% popular fiction. If you need more features, then Novelette is not for you.
%   The \footnote command has no options. Other footnote-realted commands
% are disabled.
%   If a \footnote is placed within an opening environmant, or a display page,
% it does not print a reference marker there. T the unmarked footnote appears
% at page bottom. This is standard style for general notes that are not
% specific to a sentence.
%   Otherwise, \footnote prints a symbolic reference marker, and marks the
% footnote at page bottom. The symbol will be * † ‡ § ** †† ‡‡ §§ for the
% first 8 marked footnotes. The cycle repeats, if more than 8. When an
% opening is used, the count re-sets. Swainson font has characters designed
% for this purpose. The first line of a footnote is indented.
%   If the footnote is placed very low on a page, its text may not fit there,
% so it will move to the next page. A lengthy footnote (discouraged) will not
% split to more than one page.
%%


%% FOOTNOTE (differs from standard LaTeX footnote).
\setlength\footnotesep{.83\@leading}
\newif\ifzm@rk % True for unmarked footnotes in openings.
\def\footnoterule{% You may change the width, but nothing else.
  \kern -3\p@ \hrule \@width .2\textwidth \kern 2.6\p@ %
}%
\LetLtxMacro\f@@tn@te\footnote\relax
\DeclareDocumentCommand\footnote{O{}+m}{% Option ignored.
  \iffull@page\@okfalse\else\@oktrue\fi%
  \if@ok\f@@tn@te{#2}\else\std@error{G}\fi%
}
\DeclareDocumentCommand\no@fncmd{O{}+m}{\std@error{C}}
\LetLtxMacro\footnotemark\no@fncmd\relax
\LetLtxMacro\footnotetext\no@fncmd\relax
%%


%% REFERENCE MARKS
% \@makefnmark is an existing LaTeX macro, redefined here. Marker in main text.
% Swainson has superscript symbolic markers, designed for this purpose.
\newcounter{fnm@num} \setcounter{fnm@num}{1}
\def\@makefnmark{\ifzm@rk\else\get@fnmark\fi}
\def\get@fnmark{% Places marker in the main text.
  \case@test{\arabic{fnm@num}}%
  \c@se{1}{\gdef\fn@mark{*}}%
  \c@se{2}{\gdef\fn@mark{†}}%
  \c@se{3}{\gdef\fn@mark{‡}}%
  \c@se{4}{\gdef\fn@mark{§}}%
  \c@se{5}{\gdef\fn@mark{**}}%
  \c@se{6}{\gdef\fn@mark{††}}%
  \c@se{7}{\gdef\fn@mark{‡‡}}%
  \c@se{8}{\gdef\fn@mark{§§}}%
  \sups{\fn@mark}%
}
\def\bfn@mark{% Bottom footnote marker.
  \fn@mark%
  \ifthenelse{\equal{\value{fnm@num}}{8}}%
    {\setcounter{fnm@num}{1}}%
    {\stepcounter{fnm@num}}%
}
%%


%% FOOTNOTE TEXT
% The actual footnote, at bottom of textblock, text in \@footnotesize.
\interfootnotelinepenalty=\@M % Prevent break across pages.
\long\def\@footnotetext#1{%
  \begingroup%
  \footnote@font\alt@footnote@size%
  \insert\footins{%
    \interlinepenalty\interfootnotelinepenalty%
    \floatingpenalty\@MM%
    \hsize\columnwidth%
    \@parboxrestore%
    \def\@currentcounter{footnote}%
    \protected@edef\@currentlabel{\csname p@footnote\endcsname\@thefnmark}%
    \setlength\parindent{\p@rindent}%
    \noindent\leavevmode\ignorespaces%
    \ifzm@rk%
      \noindent\rule{0pt}{.83\strut@ht}\makebox[\parindent][l]{}#1%
        \rule[-.83\strut@dp+.83\chars@dp]{0pt}{.83\strut@dp-.83\chars@dp}%
    \else%
      \noindent\rule{0pt}{.83\strut@ht}\makebox[\parindent][l]{\bfn@mark}#1%
        \rule[-.83\strut@dp+.83\chars@dp]{0pt}{.83\strut@dp-.83\chars@dp}%
    \fi%
    \ifvmode\else\par\fi%
    \vspace{0pt}%
  }%
  \endgroup%
}
%%


%%
\endinput
%%
%% End of file `novelette-footnotes.sty'.
