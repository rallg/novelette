%% This is file `novelette-coversettings.sty',
%% part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-coversettings.sty}%
[2023/09/06 v0.10 LaTeX file (Preamble settings for cover).]
%%


%%
%% Size of PDF will be automatically set by measuring cover image size.
%% You must provide interior \booksize, which is smaller than cover image.
%% The cover image has specific requirements:
%% A. Must be at 300 pixels per inch.
%% B. Must include bleed area on all four sides. Result:
%%    Height of image = (book height) + 2x (bleed).
%%    Width of image = 2x (book width) + (spine width) + 2x (bleed).
%%    Spine width depends on page count. Your print service will tell you.
%% C. Must be pre-processed using cmyk4nvt script. Result:
%%    Cover image is YourImage-nvtcCODE.jpg where CODE is a number.
%%    You must use this processed file, with that exact file name.
%% D. Image may be located in same directory as main document, or in
%%    a subdirectory relative to main document. No ../ or absolute path.
%%
%% The \covertrim sets the finished cover size, after bleed has been
%% trimmed off. Its height is exactly the same as book interior height.
%% Its width is 2x (book width) + (spine width).
%%   Your \covertrim setting will be sanity-checked against \booksize.
%% Note that these dimesnions are specifically for spftcover "Prefect Print"
%% technology, widely used by print-on-demand. If your book is hardcover,
%% or some other technology, then you cannot use Novelette cover methods.
%% 
%% Default \intent is SWOP (standard in USA). You may change using \intent.
%% If book interior and cover have different intents (unlikely),
%% then use \intent for book interior, \coverintent for cover.
%% Successful cover is always final mode. Error is draft mode.
%%   Default PDF title (in metadata) is "COVER FOR \title" where \title is same
%% as book interior. If you need something else, use \covertitle.
%%   Default PDF author (in metadata) is same as \author of book interior.
%% If you need something else, use \coverauthor.
%%


%%
\DeclareDocumentCommand\coverimage{m}{%
  \@oktrue
  \IfBeginWith{#1}{/}{\@okfalse}{}
  \IfSubStr{#1}{://}{\@okfalse}{}
  \IfBeginWith{#1}{..}{\@okfalse}{}
  \if@ok\else
    \nvt@fatal@error{Bad location for coverimage file.^^J%
      It may be same directory as main document,^^J%
      or in a subdirectory path, relative to main document.^^J%
      But you may not use an absolute path (beginning with / or ://)^^J%
      and you cannot use ../ to move up directory.}
  \fi
  \IfEndWith{#1}{.jpg}{}{
    \nvt@fatal@error{Cover image does not have ".jpg" file extension.}
  }
  \gdef\cover@image{#1}
}
%%


%%
\DeclareDocumentCommand\covertrim{m}{% Sanity-check vs booksize AtEndPreamble.
  \StrSubstitute{#1,}{ }{}[\temp@s]
  \StrBehind{\temp@s}{w=}[\temp@n]
  \StrBefore{\temp@n}{,}[\temp@n]
  \check@length{\temp@n}
  \if@ok
    \StrBehind{\temp@s}{h=}[\temp@d]
    \StrBefore{\temp@d}{,}[\temp@d]
    \check@length{\temp@d}
  \fi
  \if@ok
    \gdef\cover@trim{#1}
    \global\deflength\covertrim@w{\temp@n}
    \global\deflength\covertrim@h{\temp@d}
  \else
    \nvt@fatal@error{Bad \string\covertrim{w=W,h=H}.^^J%
      W is width of trimmed cover, units in|mm|cm.^^J%
      H is height of trimmed cover, units in|mm|cm.^^J%
      The covertrim is the finished cover size,^^J%
      after surrounding bleed has been trimmed off.^^J%
      The finished size includes rear cover, spine, front cover.^^J%
      The full size of the input cover image is larger,^^J%
      because it must include surrounding bleed areas.}
 \fi
}
%%


%%
\DeclareDocumentCommand\covertitle{m}{\gdef\cover@title{#1}}
\DeclareDocumentCommand\coverauthor{m}{\gdef\cover@author{#1}}
%%


%%
\DeclareDocumentCommand\coverintent{m}{
  \IfSubStr{:none:SWOP:FOGRA39:JC200103:custom:}{:#1:}{
    \xdef\cover@intent{#1}
  }{
    \@error{Bad \string\coverintent{choice}.^^J%
      Choices: none SWOP FOGRA39 JC200103 custom.^^J%
      Do not use custom without expertise. See docs.}
  }
}
%%


%% Ignore interior-specific settings.
\def\sheetfeed#1{}
\def\margins#1{}
\def\typesize#1{}
\def\lines#1{}
\def\layout#1{}
\def\guides#1{}
\def\setmicrotype#1{}
\def\namestyle#1{}
\def\subnamestyle#1{}
\def\myparindent#1{}
\def\warnpercent#1{}
\def\warnalert#1{}
\DeclareDocumentCommand\mainfont{O{}mO{}}{}
\DeclareDocumentCommand\sansfont{O{}mO{}}{}
\DeclareDocumentCommand\monofont{O{}mO{}}{}
\DeclareDocumentCommand\altfont{O{}mO{}}{}
\DeclareDocumentCommand\dramafont{O{}mO{}}{}
\DeclareDocumentCommand\decofont{O{}mO{}}{}
\DeclareDocumentCommand\setlang{O{}mO{}}{}
%%


%%
\endinput
%%
%% End of file `novelette-settings.sty'.
