%% This is file `novelette-headers.sty', part of `novelette' document class.
%% Copyright 2024 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-headers.sty}%
[2024/02/06 v0.38 LaTeX file (header and footer styles).]
%%


%% This file is loaded AtEndPreamble, when processing interior (not cover).
%% Looked at fancyhdr, decided it was simpler to do it directly.
%% For compatibility, \pagestyle{fancy} means \pagestyle{normal}.

%% Header text. Ignored if layout does not use it.
% Default empty in frontmatter, styled title and author in most of mainmatter.
\DeclareDocumentCommand\header{mm}{%
    \gdef\verso@head{#1}%
    \gdef\recto@head{#2}%
}
\let\headers\header\relax
%%


%%
\pagestyle{empty}
\def\wideb@r{\strut\raisebox{-.3\@leading}{{\add@font@feature{FakeStretch=2}}|}}
\DeclareDocumentCommand\absorb@graphics{O{}mO{}}{}
\def\he@dily#1{%
  \begingroup%
  \ifthenelse{\equal{\hf@font}{main}}{}{% Others do not have italics.
    \def\itshape{}\def\ital##1{##1}\def\textit##1{##1}%
  }%
  \LetLtxMacro\image\absorb@graphics%
  \LetLtxMacro\icon\absorb@graphics%
  \def\alt#1{#1}\def\fallback#1{#1}\def\textfallback#1{#1}%
  \strut\raisebox{-.3\@leading}{{\head@font#1}}%
  \endgroup%
}
\ifdefined\preamble@file
  \def\head@pn{\strut\raisebox{-.3\@leading}{{\head@font*\thepage}}}
  \def\foot@pn{\strut{\head@font*\thepage}}
\else
  \def\head@pn{\strut\raisebox{-.3\@leading}{{\head@font\thepage}}}
  \def\foot@pn{\strut{\head@font\thepage}}
\fi
%%

%% rph@l -> recto page header at left, etc.
\def\rph@l{} \def\rph@c{} \def\rph@r{} \def\vph@l{} \def\vph@c{} \def\vph@r{}
\def\rpf@l{} \def\rpf@c{} \def\rpf@r{} \def\vpf@l{} \def\vpf@c{} \def\vpf@r{}
%%

%%
\newcommand\page@head[3]{%
  \hbox to\textwidth{%
  \vbox to\headheight{%
  \hbox{%
    \rlap{\makebox[\textwidth][l]{\ignorespaces#1}}%
    \makebox[\textwidth][c]{\ignorespaces#2}%
    \llap{\makebox[\textwidth][r]{\ignorespaces#3}}%
  }}}%
}
%%

%%
\newcommand\page@foot[3]{%
  \hbox to\textwidth{%
  \vbox to\footskip{%
  \setlength\temp@l{\strut@dp+\hf@gap\@leading}%
  \vskip\temp@l%
  \hbox{%
    \rlap{\makebox[\textwidth][l]{\ignorespaces#1}}%
    \makebox[\textwidth][c]{\ignorespaces#2}%
    \llap{\makebox[\textwidth][r]{\ignorespaces#3}}%
  }}}%
}
%%

%%
\def\ps@headfoot{
  \ps@empty
  \def\@oddhead{\page@head\rph@l\rph@c\rph@r}
  \def\@oddfoot{\page@foot\rpf@l\rpf@c\rpf@r}
  \def\@evenhead{\page@head\vph@l\vph@c\vph@r}
  \def\@evenfoot{\page@foot\vpf@l\vpf@c\vpf@r}
}
%%
\def\ps@head{
  \ps@empty
  \def\@oddhead{\page@head\rph@l\rph@c\rph@r}
  \let\@oddfoot\@empty
  \def\@evenhead{\page@head\vph@l\vph@c\vph@r}
  \let\@evenfoot\@empty
}
%%
\def\ps@foot{
  \ps@empty
  \let\@oddhead\@empty
  \def\@oddfoot{\page@foot\rpf@l\rpf@c\rpf@r}
  \let\@evenhead\@empty
  \def\@evenfoot{\page@foot\vpf@l\vpf@c\vpf@r}
}
%%
\let\ps@plain\ps@foot\relax % Re-defined from LaTeX internal.
%%


%%
\def\process@headfoot{
  \case@test{\@scheme}
  \c@se{0}{
    \let\ps@normal\ps@empty\relax
    \let\ps@fancy\ps@empty\relax
    \let\ps@plain\ps@empty\relax
  }
  \c@se{1}{
    \def\rpf@c{\foot@pn}
    \def\vpf@c{\foot@pn}
    \let\ps@normal\ps@foot\relax
    \let\ps@fancy\ps@foot\relax
    \let\ps@plain\ps@foot\relax
  }
  \c@se{2}{
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\rpf@c{\foot@pn}
    \def\vpf@c{\foot@pn}
    \let\ps@normal\ps@headfoot\relax
    \let\ps@fancy\ps@headfoot\relax
    \let\ps@plain\ps@foot\relax
  }
  \c@se{3}{
    \def\vph@l{\he@dily{\verso@head}}
    \def\rph@r{\he@dily{\recto@head}}
    \def\rpf@r{\foot@pn}
    \def\vpf@l{\foot@pn}
    \let\ps@normal\ps@headfoot\relax
    \let\ps@fancy\ps@headfoot\relax
    \let\ps@plain\ps@foot\relax
  }
  \c@se{4}{
    \def\vph@l{\head@pn}
    \def\rph@r{\head@pn}
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \let\ps@normal\ps@head\relax
    \let\ps@fancy\ps@head\relax
    \let\ps@plain\ps@empty\relax
  }
  \c@se{5}{
    \def\vph@l{\makebox[2\p@rindent][l]{\head@pn}\wideb@r}
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\rph@r{\wideb@r\makebox[2\p@rindent][r]{\head@pn}}
    \let\ps@normal\ps@head\relax
    \let\ps@fancy\ps@head\relax
    \let\ps@plain\ps@empty\relax
  }
  \c@se{6}{
    \def\vph@l{\head@pn~/}
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\rph@r{/~\head@pn}
    \let\ps@normal\ps@head\relax
    \let\ps@fancy\ps@head\relax
    \let\ps@plain\ps@empty\relax
  }
  \c@se{7}{
    \def\vph@c{\head@pn~/~\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}~/~\head@pn}
    \let\ps@normal\ps@head\relax
    \let\ps@fancy\ps@head\relax
    \let\ps@plain\ps@empty\relax
  }
  \c@se{8}{
    \ifthenelse{\equal{\pi@v}{}}{
      \def\vph@l{\head@pn}
    }{
      \def\vph@l{\makebox[2\p@rindent][s]{\head@pn}\icon{\pi@v}}
    }
    \ifthenelse{\equal{\pi@r}{}}{
      \def\rph@r{\head@pn}
    }{
      \def\rph@r{\icon{\pi@r}\makebox[2\p@rindent][s]{\head@pn}}
    }
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \let\ps@normal\ps@head\relax
    \let\ps@fancy\ps@head\relax
    \let\ps@plain\ps@empty\relax
  }
  \c@se{9}{
    \ifthenelse{\equal{\pi@v}{}}{
      \def\vph@c{\head@pn\space\wideb@r\space\he@dily{\verso@head}}
    }{ 
      \def\vph@c{\head@pn\space\icon{pi@v}\space\he@dily{\verso@head}}
    }
    \ifthenelse{\equal{\pi@r}{}}{
      \def\rph@c{\he@dily{\recto@head}\space\wideb@r\space\head@pn}
    }{
      \def\rph@c{\he@dily{\recto@head}\space\icon{pi@r}\space\head@pn}
    }
    \let\ps@normal\ps@head\relax
    \let\ps@fancy\ps@head\relax
    \let\ps@plain\ps@empty\relax
  }
}
%%


%%
\endinput
%%
%% End of file `novelette-headers.sty'
