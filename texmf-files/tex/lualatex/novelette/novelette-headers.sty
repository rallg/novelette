%% This is file `novelette-headers.sty', part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3c.
%%
\ProvidesFile{novelette-headers.sty}%
[2023/12/05 v0.23 LaTeX file (header and footer styles).]
%%


%% This file is loaded AtEndPreamble, when processing interior (not cover).
%% Looked at fancyhdr, decided it was simpler to do it directly.


%% Header text. Ignored if layout does not use it.
% Default empty in frontmatter, styled title and author in most of mainmatter.
\DeclareDocumentCommand\header{mm}{%
    \gdef\verso@head{#1}%
    \gdef\recto@head{#2}%
}
\LetLtxMacro\headers\header\relax
%%


%%
\pagestyle{empty}
\def\main@pagestyle{empty}
\def\wideb@r{\strut\char"2759}
\def\he@dily#1{%
  \begingroup\head@foottrue%
  \ifsans@hf% No need for fallback.
    \def\alt#1{#1}\def\fallback#1{#1}\def\textfallback#1{#1}%
  \fi%
  \strut\raisebox{-.3\@leading}{{\head@font#1}}
  \endgroup%
}
\def\p@genumber{\strut{\head@font\thepage}}
%%

%% rph@l -> recto page header at left, etc.
\def\rph@l{} \def\rph@c{} \def\rph@r{} \def\vph@l{} \def\vph@c{} \def\vph@r{}
\def\rpf@l{} \def\rpf@c{} \def\rpf@r{} \def\vpf@l{} \def\vpf@c{} \def\vpf@r{}
%%

%%
\newcommand\page@head[3]{%
  \hbox to\textwidth{%
  \vbox to\headheight{%
  \hbox{%
    \rlap{\makebox[\textwidth][l]{\ignorespaces#1}}%
    \makebox[\textwidth][c]{\ignorespaces#2}%
    \llap{\makebox[\textwidth][r]{\ignorespaces#3}}%
  }}}%
}
%%

%%
\newcommand\page@foot[3]{%
  \hbox to\textwidth{%
  \vbox to\footskip{%
  \setlength\temp@l{\strut@dp+\f@gap\@leading-.015\type@size}% Antialiasing.
  \vskip\temp@l%
  \hbox{%
    \rlap{\makebox[\textwidth][l]{\ignorespaces#1}}%
    \makebox[\textwidth][c]{\ignorespaces#2}%
    \llap{\makebox[\textwidth][r]{\ignorespaces#3}}%
  }}}%
}
%%


\def\ps@headfoot{
  \ps@empty
  \def\@oddhead{\page@head\rph@l\rph@c\rph@r}
  \def\@oddfoot{\page@foot\rpf@l\rpf@c\rpf@r}
  \def\@evenhead{\page@head\vph@l\vph@c\vph@r}
  \def\@evenfoot{\page@foot\vpf@l\vpf@c\vpf@r}
}

\def\ps@head{
  \ps@empty
  \def\@oddhead{\page@head\rph@l\rph@c\rph@r}
  \let\@oddfoot\@empty
  \def\@evenhead{\page@head\vph@l\vph@c\vph@r}
  \let\@evenfoot\@empty
}

\def\ps@foot{
  \ps@empty
  \let\@oddhead\@empty
  \def\@oddfoot{\page@foot\rpf@l\rpf@c\rpf@r}
  \let\@evenhead\@empty
  \def\@evenfoot{\page@foot\vpf@l\vpf@c\vpf@r}
}

\let\ps@plain\ps@foot\relax % Re-defined from LaTeX internal.

\newcommand\iffloatpage[2]{\if@fcolmade #1\else #2\fi}


%%
\def\process@headfoot{
  \case@test{\@scheme}
  \c@se{1}{
    \def\rpf@c{\p@genumber}
    \def\vpf@c{\p@genumber}
    \def\main@pagestyle{foot}
  }
  \c@se{2}{
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\rpf@c{\p@genumber}
    \def\vpf@c{\p@genumber}
    \def\main@pagestyle{headfoot}
  }
  \c@se{3}{
    \def\vph@l{\he@dily{\verso@head}}
    \def\rph@r{\he@dily{\recto@head}}
    \def\rpf@r{\p@genumber}
    \def\vpf@l{\p@genumber}
    \def\main@pagestyle{headfoot}
  }
  \c@se{4}{
    \def\vph@l{\he@dily{\p@genumber}}
    \def\rph@r{\he@dily{\p@genumber}}
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\main@pagestyle{head}
  }
  \c@se{5}{
    \def\vph@l{\he@dily{%
      \makebox[2\p@rindent][l]{\p@genumber}\wideb@r}}
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\rph@r{\he@dily{%
      \wideb@r\makebox[2\p@rindent][r]{\p@genumber}}}
    \def\main@pagestyle{head}
  }
  \c@se{6}{
    \def\vph@l{\he@dily{\p@genumber~/}}
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\rph@r{\he@dily{/~\p@genumber}}
    \def\main@pagestyle{head}
  }
  \c@se{7}{
    \def\vph@c{\he@dily{\p@genumber~/~\verso@head}}
    \def\rph@c{\he@dily{\recto@head~/~\p@genumber}}
    \main@pagestyle{head}
  }
  \c@se{8}{
    \ifthenelse{\equal{\pi@v}{}}{
      \def\vph@l{\he@dily{\p@genumber}}
    }{
      \def\vph@l{\he@dily{\makebox[2\p@rindent][s]{\p@genumber}\icon{\pi@v}}}
    }
    \ifthenelse{\equal{\pi@r}{}}{
      \def\rph@r{\he@dily{\p@genumber}}
    }{
      \def\rph@r{\he@dily{\icon{\pi@r}\makebox[2\p@rindent][s]{\p@genumber}}}
    }
    \def\vph@c{\he@dily{\verso@head}}
    \def\rph@c{\he@dily{\recto@head}}
    \def\main@pagestyle{head}
  }
}
%%


%%
\endinput
%%
%% End of file `novelette-headers.sty'
